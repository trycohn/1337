# üöÄ –î–ï–ü–õ–û–ô: –û–°–û–ë–´–ô –§–û–†–ú–ê–¢ –î–õ–Ø –§–ò–ù–ê–õ–û–í

**–î–∞—Ç–∞:** 3 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 4.27.0  
**–§–∏—á–∏:** –û—Å–æ–±—ã–π —Ñ–æ—Ä–º–∞—Ç –º–∞—Ç—á–µ–π —Ñ–∏–Ω–∞–ª–∞ + –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ backend —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤

---

## ‚úÖ –ß–¢–û –î–û–ë–ê–í–õ–ï–ù–û

### Frontend:
1. ‚úÖ **Step4_Rules (Wizard)** - —á–µ–∫–±–æ–∫—Å "–û—Å–æ–±—ã–π —Ñ–æ—Ä–º–∞—Ç –º–∞—Ç—á–µ–π —Ñ–∏–Ω–∞–ª–∞" + –≤—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é
2. ‚úÖ **Step6_Preview (Wizard)** - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ —Ñ–∏–Ω–∞–ª–∞
3. ‚úÖ **CreateTournamentManual** - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
4. ‚úÖ **ModeSelector** - –≤—Å—è –∫–∞—Ä—Ç–æ—á–∫–∞ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞ (—É–±—Ä–∞–Ω—ã –∫–Ω–æ–ø–∫–∏)

### Backend:
1. ‚úÖ **TournamentService.js** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ final_match_format
2. ‚úÖ **TournamentRepository.js** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î (lobby_match_format + final_match_format)
3. ‚úÖ **tournament-drafts.js** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç middleware (authenticateToken)

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
1. ‚úÖ **–ú–∏–≥—Ä–∞—Ü–∏—è 20251003_add_final_match_format.sql:**
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `lobby_match_format` (–µ—Å–ª–∏ –Ω–µ –±—ã–ª–æ)
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `final_match_format`
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π (bo1, bo3, bo5)

---

## üîß –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –î–ï–ü–õ–û–Æ

### –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ VDS

```bash
ssh root@80.87.200.23
```

### –®–∞–≥ 2: –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø—Ä–æ–µ–∫—Ç

```bash
cd /var/www/1337community.com/
```

### –®–∞–≥ 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ GitHub

```bash
git pull origin main
```

### –®–∞–≥ 4: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î

```bash
# –ú–∏–≥—Ä–∞—Ü–∏—è 1: –ß–µ—Ä–Ω–æ–≤–∏–∫–∏ —Ç—É—Ä–Ω–∏—Ä–æ–≤
sudo -u postgres psql -d tournament_db -f backend/migrations/20251003_create_tournament_drafts.sql

# –ú–∏–≥—Ä–∞—Ü–∏—è 2: –§–æ—Ä–º–∞—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –º–∞—Ç—á–µ–π
sudo -u postgres psql -d tournament_db -f backend/migrations/20251003_add_final_match_format.sql
```

### –®–∞–≥ 5: –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ Frontend

```bash
cd frontend
npm run build
```

### –®–∞–≥ 6: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Nginx

```bash
sudo cp -r build/* /var/www/html/1337community/
```

### –®–∞–≥ 7: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Backend

```bash
pm2 restart 1337-backend
```

### –®–∞–≥ 8: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ Nginx

```bash
sudo systemctl reload nginx
```

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –†–ê–ë–û–¢–û–°–ü–û–°–û–ë–ù–û–°–¢–ò

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Backend

```bash
# –°—Ç–∞—Ç—É—Å PM2
pm2 status

# –õ–æ–≥–∏ (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫)
pm2 logs 1337-backend --lines 50

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# ‚úÖ –§–∞–π–ª .env —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω
# ‚úÖ Backend —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3000
# –ë–ï–ó: Error: Route.post() requires a callback function
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏
sudo -u postgres psql -d tournament_db -c "\d tournaments" | grep match_format

# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
# lobby_match_format  | character varying(10) |
# final_match_format  | character varying(10) |
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Frontend

–û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `https://1337community.com/create`

**–ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç:**

- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è 2 –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (–±–µ–∑ –∫–Ω–æ–ø–æ–∫)
- [ ] –ö–ª–∏–∫ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É "–ú–∞—Å—Ç–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è" ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è Wizard
- [ ] –ö–ª–∏–∫ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É "–†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞" ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ä–∞—è —Ñ–æ—Ä–º–∞
- [ ] –í Wizard –Ω–∞ —à–∞–≥–µ 4 (–ü—Ä–∞–≤–∏–ª–∞) –µ—Å—Ç—å —á–µ–∫–±–æ–∫—Å "–û—Å–æ–±—ã–π —Ñ–æ—Ä–º–∞—Ç –º–∞—Ç—á–µ–π —Ñ–∏–Ω–∞–ª–∞"
- [ ] –ü—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —á–µ–∫–±–æ–∫—Å–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é —Å bo1/bo3/bo5
- [ ] –ù–∞ —à–∞–≥–µ 6 (–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä) –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∏–Ω–∞–ª–∞
- [ ] –í —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –µ—Å—Ç—å —Ç–∞ –∂–µ —Ñ—É–Ω–∫—Ü–∏—è (–ø–æ—Å–ª–µ "–§–æ—Ä–º–∞—Ç –º–∞—Ç—á–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é")
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫

---

## üéØ –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

### –ü—Ä–∏–º–µ—Ä 1: Daily Cup —Å –æ—Å–æ–±—ã–º —Ñ–∏–Ω–∞–ª–æ–º

```
–§–æ—Ä–º–∞—Ç –º–∞—Ç—á–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: BO1 (–±—ã—Å—Ç—Ä—ã–µ –º–∞—Ç—á–∏)
‚úì –û—Å–æ–±—ã–π —Ñ–æ—Ä–º–∞—Ç –º–∞—Ç—á–µ–π —Ñ–∏–Ω–∞–ª–∞
  ‚îî‚îÄ –§–æ—Ä–º–∞—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –º–∞—Ç—á–µ–π: BO3 (–±–æ–ª–µ–µ —Å–µ—Ä—å–µ–∑–Ω—ã–π —Ñ–∏–Ω–∞–ª)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ –º–∞—Ç—á–∏ BO1, –Ω–æ —Ñ–∏–Ω–∞–ª, –ø–æ–ª—É—Ñ–∏–Ω–∞–ª –∏ –≥—Ä–∞–Ω–¥-—Ñ–∏–Ω–∞–ª - BO3

### –ü—Ä–∏–º–µ—Ä 2: Weekly Championship

```
–§–æ—Ä–º–∞—Ç –º–∞—Ç—á–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: BO3 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)
‚úì –û—Å–æ–±—ã–π —Ñ–æ—Ä–º–∞—Ç –º–∞—Ç—á–µ–π —Ñ–∏–Ω–∞–ª–∞
  ‚îî‚îÄ –§–æ—Ä–º–∞—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –º–∞—Ç—á–µ–π: BO5 (—ç–ø–∏—á–Ω—ã–π —Ñ–∏–Ω–∞–ª)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ –º–∞—Ç—á–∏ BO3, –Ω–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –º–∞—Ç—á–∏ - BO5

---

## üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ü–†–û–ë–õ–ï–ú

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Backend –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
pm2 logs 1337-backend --err --lines 100

# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "Route.post() requires a callback function":
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤ tournament-drafts.js –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è authenticateToken
grep "const.*auth" backend/routes/tournament-drafts.js

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# const { authenticateToken } = require('../middleware/auth');
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
sudo -u postgres psql -d tournament_db -c "SELECT version();"

# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é
sudo -u postgres psql -d tournament_db

# –í psql:
\i /var/www/1337community.com/backend/migrations/20251003_add_final_match_format.sql
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Frontend –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

```bash
# –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à Nginx
sudo systemctl restart nginx

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ build —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω
ls -la /var/www/html/1337community/ | grep -i create

# –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+R)
```

---

## üìä –ù–û–í–´–ï API ENDPOINTS

### –ß–µ—Ä–Ω–æ–≤–∏–∫–∏ —Ç—É—Ä–Ω–∏—Ä–æ–≤:

```bash
# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫
curl -X POST https://1337community.com/api/tournaments/drafts \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"draft_data": {...}, "current_step": 3}'

# –ü–æ–ª—É—á–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫–∏
curl -X GET https://1337community.com/api/tournaments/drafts \
  -H "Authorization: Bearer YOUR_TOKEN"

# –£–¥–∞–ª–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫
curl -X DELETE https://1337community.com/api/tournaments/drafts/1 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

---

## üé® –í–ò–ó–£–ê–õ–¨–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### –î–æ (—Å –∫–Ω–æ–ø–∫–∞–º–∏):
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üßô –ú–ê–°–¢–ï–†          ‚îÇ
‚îÇ  ...               ‚îÇ
‚îÇ  [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å] ‚≠ê  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—Å–ª–µ (–≤—Å—è –∫–∞—Ä—Ç–æ—á–∫–∞ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞):
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üßô –ú–ê–°–¢–ï–†          ‚îÇ ‚Üê –í—Å—è –∫–∞—Ä—Ç–æ—á–∫–∞
‚îÇ  ...               ‚îÇ   –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞
‚îÇ  –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ ‚Üí‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìà –ú–ï–¢–†–ò–ö–ò –£–°–ü–ï–•–ê

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ:

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Wizard** - % —Å–æ–∑–¥–∞–Ω–∏—è —á–µ—Ä–µ–∑ Wizard vs –†—É—á–Ω–∞—è
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Å–æ–±–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞** - % —Ç—É—Ä–Ω–∏—Ä–æ–≤ —Å final_match_format
3. **Bounce rate** - —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ —ç—Ç–∞–ø–µ —Å–æ–∑–¥–∞–Ω–∏—è
4. **–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è** - —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –¥–æ –∫–Ω–æ–ø–∫–∏ "–°–æ–∑–¥–∞—Ç—å"
5. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —á–µ—Ä–Ω–æ–≤–∏–∫–∏** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π

---

## üÜò –û–¢–ö–ê–¢ (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

### –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π –ë–î:

```sql
-- –û—Ç–∫–∞—Ç —Ñ–æ—Ä–º–∞—Ç–∞ —Ñ–∏–Ω–∞–ª–æ–≤
ALTER TABLE tournaments DROP COLUMN IF EXISTS final_match_format;
ALTER TABLE tournaments DROP COLUMN IF EXISTS lobby_match_format;

-- –û—Ç–∫–∞—Ç —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤
DROP TABLE IF EXISTS tournament_drafts CASCADE;
```

### –û—Ç–∫–∞—Ç –∫–æ–¥–∞:

```bash
# –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–º–º–∏—Ç
git log --oneline -5
git checkout <previous_commit_hash>

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å
cd frontend && npm run build
sudo cp -r build/* /var/www/html/1337community/
pm2 restart 1337-backend
```

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

**–§–∞–π–ª—ã –¥–ª—è –¥–µ–±–∞–≥–∞:**

Frontend:
- `frontend/src/pages/create-tournament/components/steps/Step4_Rules.js`
- `frontend/src/pages/create-tournament/CreateTournamentWizard.js`
- `frontend/src/pages/create-tournament/CreateTournamentManual.js`

Backend:
- `backend/routes/tournament-drafts.js`
- `backend/services/tournament/TournamentService.js`
- `backend/repositories/tournament/TournamentRepository.js`

–ú–∏–≥—Ä–∞—Ü–∏–∏:
- `backend/migrations/20251003_create_tournament_drafts.sql`
- `backend/migrations/20251003_add_final_match_format.sql`

---

**–ì–û–¢–û–í–û –ö –î–ï–ü–õ–û–Æ!** ‚úÖ

–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
1. git pull
2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ–±–µ –º–∏–≥—Ä–∞—Ü–∏–∏
3. npm run build
4. –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å build
5. pm2 restart
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

