# üéØ –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï –î–õ–Ø –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø –ü–û–ë–ï–î–ò–¢–ï–õ–ï–ô

> **üì¶ VDS Deployment Update**: 2025-01-25  
> **üéØ –í–µ—Ä—Å–∏—è**: v4.7.0 (–£–ù–ò–í–ï–†–°–ê–õ–¨–ù–ê–Ø –ü–û–î–î–ï–†–ñ–ö–ê –ö–û–ú–ê–ù–î –ò –°–û–õ–û –¢–£–†–ù–ò–†–û–í)  
> **üîÑ –°—Ç–∞—Ç—É—Å**: Production ready with universal winner determination  
> **üìã –¶–µ–ª—å**: –°–æ–∑–¥–∞–Ω–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –≤ –∫–æ–º–∞–Ω–¥–Ω—ã—Ö –∏ —Å–æ–ª–æ —Ç—É—Ä–Ω–∏—Ä–∞—Ö  

## üÜï –ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û –í V4.7.0

### üîß **Frontend –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

#### **1. TournamentDetails.js - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è winner_team_id**
```javascript
// ‚úÖ –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï:
if (resultData.winner === 'team1') {
    winner_team_id = matchData.team1_id; // –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –∫–æ–º–∞–Ω–¥ –ò —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
} else if (resultData.winner === 'team2') {
    winner_team_id = matchData.team2_id; // –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –∫–æ–º–∞–Ω–¥ –ò —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
}

// ‚úÖ –í–ê–õ–ò–î–ê–¶–ò–Ø –ü–û –¢–ò–ü–£ –¢–£–†–ù–ò–†–ê:
if (tournament.participant_type === 'solo' && tournament.participants) {
    isValidWinner = tournament.participants.some(p => p.id === winner_team_id);
} else if (tournament.participant_type === 'team' && tournament.teams) {
    isValidWinner = tournament.teams.some(t => t.id === winner_team_id);
}
```

#### **2. MatchResultModal.js - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ**
```javascript
// ‚úÖ –ê–î–ê–ü–¢–ò–í–ù–´–ï –ù–ê–ó–í–ê–ù–ò–Ø:
{selectedMatch.team1_name || 
 (tournament?.participant_type === 'solo' ? '–£—á–∞—Å—Ç–Ω–∏–∫ 1' : '–ö–æ–º–∞–Ω–¥–∞ 1')}

// ‚úÖ –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø WINNER_TEAM_ID:
let winner_team_id = null;
if (finalWinner === 'team1') {
    winner_team_id = selectedMatch.team1_id; // ID —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–ª–∏ –∫–æ–º–∞–Ω–¥—ã
} else if (finalWinner === 'team2') {
    winner_team_id = selectedMatch.team2_id; // ID —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–ª–∏ –∫–æ–º–∞–Ω–¥—ã
}
```

#### **3. MatchDetailsModal.js - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ**
```javascript
// ‚úÖ –ê–î–ê–ü–¢–ò–í–ù–´–ï –ù–ê–ó–í–ê–ù–ò–Ø –í –ü–†–û–°–ú–û–¢–†–ï:
{selectedMatch.team1_name || 
 (tournament?.participant_type === 'solo' ? '–£—á–∞—Å—Ç–Ω–∏–∫ 1' : '–ö–æ–º–∞–Ω–¥–∞ 1')}
```

### üîß **Backend –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

#### **1. MatchService.js - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**
```javascript
// ‚úÖ –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–ê–Ø –í–ê–õ–ò–î–ê–¶–ò–Ø –ò –ü–†–ï–û–ë–†–ê–ó–û–í–ê–ù–ò–ï:
let finalWinnerTeamId = resultData.winner_team_id;

if (!finalWinnerTeamId && resultData.winner && match.team1_id && match.team2_id) {
    if (resultData.winner === 'team1') {
        finalWinnerTeamId = match.team1_id; // ID —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–ª–∏ –∫–æ–º–∞–Ω–¥—ã
    } else if (resultData.winner === 'team2') {
        finalWinnerTeamId = match.team2_id; // ID —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–ª–∏ –∫–æ–º–∞–Ω–¥—ã
    }
}

// ‚úÖ –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø:
if (tournament.participant_type === 'solo') {
    // –ü–æ–ª—É—á–∞–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–∑ tournament_participants
    const p1 = await pool.query('SELECT name, username FROM tournament_participants WHERE id = $1', [match.team1_id]);
    team1Name = p1.rows[0]?.name || p1.rows[0]?.username || `–£—á–∞—Å—Ç–Ω–∏–∫ ${match.team1_id}`;
} else {
    // –ü–æ–ª—É—á–∞–µ–º –∫–æ–º–∞–Ω–¥—ã –∏–∑ tournament_teams
    const t1 = await pool.query('SELECT name FROM tournament_teams WHERE id = $1', [match.team1_id]);
    team1Name = t1.rows[0]?.name || `–ö–æ–º–∞–Ω–¥–∞ ${match.team1_id}`;
}
```

### üóÉÔ∏è **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î**

#### **–ö–æ–º–∞–Ω–¥–Ω—ã–µ —Ç—É—Ä–Ω–∏—Ä—ã (participant_type = 'team')**
```sql
-- team1_id/team2_id —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ tournament_teams.id
-- winner_team_id —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ tournament_teams.id
SELECT * FROM matches WHERE tournament_id = X;
-- team1_id = 123 (ID –∫–æ–º–∞–Ω–¥—ã)
-- team2_id = 124 (ID –∫–æ–º–∞–Ω–¥—ã) 
-- winner_team_id = 123 (ID –∫–æ–º–∞–Ω–¥—ã-–ø–æ–±–µ–¥–∏—Ç–µ–ª—è)
```

#### **–°–æ–ª–æ —Ç—É—Ä–Ω–∏—Ä—ã (participant_type = 'solo')**
```sql
-- team1_id/team2_id —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ tournament_participants.id
-- winner_team_id —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ tournament_participants.id
SELECT * FROM matches WHERE tournament_id = Y;
-- team1_id = 456 (ID —É—á–∞—Å—Ç–Ω–∏–∫–∞)
-- team2_id = 457 (ID —É—á–∞—Å—Ç–Ω–∏–∫–∞)
-- winner_team_id = 456 (ID —É—á–∞—Å—Ç–Ω–∏–∫–∞-–ø–æ–±–µ–¥–∏—Ç–µ–ª—è)
```

## üîß –ú–ï–•–ê–ù–ò–ö–ê –†–ê–ë–û–¢–´

### **1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ç—É—Ä–Ω–∏—Ä–∞**
```javascript
const participantType = tournament?.participant_type; // 'solo' –∏–ª–∏ 'team'
const entityType = participantType === 'solo' ? '—É—á–∞—Å—Ç–Ω–∏–∫–∞' : '–∫–æ–º–∞–Ω–¥—ã';
```

### **2. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ winner_team_id**
```javascript
// –ù–∞ Frontend (MatchResultModal):
if (finalWinner === 'team1') {
    winner_team_id = selectedMatch.team1_id; // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ: ID –∫–æ–º–∞–Ω–¥—ã –∏–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞
}

// –ù–∞ Backend (MatchService):
finalWinnerTeamId = resultData.winner_team_id; // –ü–æ–ª—É—á–µ–Ω —Å Frontend
```

### **3. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
```javascript
// Backend –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
const matchType = tournament.participant_type === 'solo' ? '–ü–æ–µ–¥–∏–Ω–æ–∫' : '–ú–∞—Ç—á';
const entityType = tournament.participant_type === 'solo' ? '—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤' : '–∫–æ–º–∞–Ω–¥';

const announcement = `${matchType} –º–µ–∂–¥—É ${entityType} ${team1Name} –∏ ${team2Name} –∑–∞–≤–µ—Ä—à–µ–Ω...`;
```

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### **–ö–æ–º–∞–Ω–¥–Ω—ã–µ —Ç—É—Ä–Ω–∏—Ä—ã**
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä —Å `participant_type = 'team'`
2. ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–∫—É —Å –∫–æ–º–∞–Ω–¥–∞–º–∏
3. ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Ç—á–∞ - –¥–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è –∫–æ–º–∞–Ω–¥–∞-–ø–æ–±–µ–¥–∏—Ç–µ–ª—å
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–ú–∞—Ç—á –º–µ–∂–¥—É –∫–æ–º–∞–Ω–¥ ... –∑–∞–≤–µ—Ä—à–µ–Ω"

### **–°–æ–ª–æ —Ç—É—Ä–Ω–∏—Ä—ã**
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Å–æ–ª–æ —Ç—É—Ä–Ω–∏—Ä —Å `participant_type = 'solo'`
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
3. ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–∫—É —Å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
4. ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Ç—á–∞ - –¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è —É—á–∞—Å—Ç–Ω–∏–∫-–ø–æ–±–µ–¥–∏—Ç–µ–ª—å  
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–ü–æ–µ–¥–∏–Ω–æ–∫ –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ ... –∑–∞–≤–µ—Ä—à–µ–Ω"

## üöÄ –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï

```bash
# 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@80.87.200.23

# 2. –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /var/www/1337community.com/

# 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ V4.7.0)
git pull origin main

# 4. –ü–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∞ frontend (—Å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏)
cd frontend && npm run build

# 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ backend (—Å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π)
pm2 restart 1337-backend

# 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
pm2 logs 1337-backend

# 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ nginx
systemctl reload nginx
```

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –†–ê–ë–û–¢–û–°–ü–û–°–û–ë–ù–û–°–¢–ò

### **–í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```bash
# –î–ª—è –∫–æ–º–∞–Ω–¥:
üèÜ –ò—Ç–æ–≥–æ–≤—ã–π winner_team_id: 123 (ID –∫–æ–º–∞–Ω–¥—ã)
üì¢ –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è —Ç—É—Ä–Ω–∏—Ä–∞ —Ç–∏–ø–∞ "team"
‚úÖ –ü–æ–ª—É—á–µ–Ω—ã –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥: "Team Alpha" vs "Team Beta"

# –î–ª—è —Å–æ–ª–æ:
üèÜ –ò—Ç–æ–≥–æ–≤—ã–π winner_team_id: 456 (ID —É—á–∞—Å—Ç–Ω–∏–∫–∞)  
üì¢ –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è —Ç—É—Ä–Ω–∏—Ä–∞ —Ç–∏–ø–∞ "solo"
‚úÖ –ü–æ–ª—É—á–µ–Ω—ã –∏–º–µ–Ω–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: "Player1" vs "Player2"
```

### **–í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
- ‚úÖ –ö–æ–º–∞–Ω–¥–Ω—ã–µ —Ç—É—Ä–Ω–∏—Ä—ã: "–ö–æ–º–∞–Ω–¥–∞ 1", "–ö–æ–º–∞–Ω–¥–∞ 2" –∏–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥
- ‚úÖ –°–æ–ª–æ —Ç—É—Ä–Ω–∏—Ä—ã: "–£—á–∞—Å—Ç–Ω–∏–∫ 1", "–£—á–∞—Å—Ç–Ω–∏–∫ 2" –∏–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –≤ —Å–ª–µ–¥—É—é—â–∏–µ –º–∞—Ç—á–∏
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —á–∞—Ç–µ —Ç—É—Ä–Ω–∏—Ä–∞

## üèÜ –ò–¢–û–ì–ò V4.7.0

**üéØ –°–æ–∑–¥–∞–Ω–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ**, –∫–æ—Ç–æ—Ä–æ–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ —Ö–æ—Ä–æ—à–æ –¥–ª—è:
- **–ö–æ–º–∞–Ω–¥–Ω—ã—Ö —Ç—É—Ä–Ω–∏—Ä–æ–≤** (team): –ö–æ–º–∞–Ω–¥—ã vs –ö–æ–º–∞–Ω–¥—ã
- **–°–æ–ª–æ —Ç—É—Ä–Ω–∏—Ä–æ–≤** (solo): –£—á–∞—Å—Ç–Ω–∏–∫ vs –£—á–∞—Å—Ç–Ω–∏–∫  
- **Mix —Ç—É—Ä–Ω–∏—Ä–æ–≤** (mix): –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã vs –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

**üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** —Å—Ç–∞–ª–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π:
- Frontend –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —Ç—É—Ä–Ω–∏—Ä–∞ –∏ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- Backend —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç winner_team_id –¥–ª—è –ª—é–±–æ–≥–æ —Ç–∏–ø–∞ —Ç—É—Ä–Ω–∏—Ä–∞  
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–¥–∏–Ω—É—é —Å—Ö–µ–º—É –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ç—É—Ä–Ω–∏—Ä–æ–≤
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ–¥ —Ç–∏–ø —Ç—É—Ä–Ω–∏—Ä–∞

**üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É**: 100% —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ –≤—Å–µ–º–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Ç—É—Ä–Ω–∏—Ä–∞–º–∏ 