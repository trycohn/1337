import{j as e,r as b,a as I}from"./app-2-nbgIXB.js";import{u as U,B as C}from"./index-nS5Yp60y.js";import{c as g}from"./clsx-B-dksMZM.js";import{D as r,i as k,u as y,b as E,d as F,q as D,c as v,r as w,t as H,v as L,w as P,n as G,x as z,y as S}from"./SidebarMini-CfCRdJqb.js";import{a as V,n as X,o as _,B as q,e as N,p as K,g as Y}from"./index-Dx4gZyUt.js";function J(){return e.jsx("span",{className:"absolute right-3 h-2.5 w-2.5 rounded-full bg-primary"})}function Q({chat:n}){return e.jsx("div",{className:"absolute right-8 shrink-0",children:e.jsx(r,{children:e.jsx(W,{chat:n})})})}const W=({chat:n})=>{var j;const{auth:i,syncNotification:l}=k(),{chats:c,setChats:o,refetchChats:x}=y(),{user:t,setUser:p}=E(),{openModal:d}=F(),{open:m}=D(),u=b.useRef(null),s=(((j=u.current)==null?void 0:j.getBoundingClientRect().bottom)||0)<window.innerHeight-100,h=()=>{w(n).then(()=>{o(c.map(a=>(a.id===n.id&&(a.is_read=!0),a))),l()})},f=()=>{H(n).then(()=>{o(c.map(a=>(a.id===n.id&&(a.is_read=!1),a))),l()})},B=()=>{L(n).then(()=>{x(),l()})},A=()=>{P(n).then(()=>{x(),l()})},T=()=>{d({view:"DELETE_CHAT_CONFIRMATION",size:"lg",payload:n})},R=()=>{d({view:"BLOCK_CONTACT_CONFIRMATION",size:"lg",payload:n})},M=()=>{G(n.id).then(()=>{o(c.map(a=>(a.id===n.id&&(a.is_contact_blocked=!1),a))),(t==null?void 0:t.id)===n.id&&p({...t,is_contact_blocked:!1})})},O=()=>{d({view:"EXIT_GROUP_CONFIRMATION",size:"lg",payload:n})};return e.jsxs("div",{ref:u,children:[e.jsx(r.Trigger,{children:e.jsx("button",{type:"button",className:g("rounded-full border border-secondary bg-background p-1.5 shadow-sm group-hover:visible group-hover:flex",m?"visible":"invisible"),children:e.jsx(V,{className:"text-secondary-foreground"})})}),e.jsxs(r.Content,{align:s?"right":"top-right",contentClasses:s?"":"mb-7",children:[i.id!==n.id&&i.id!==n.from_id&&e.jsx(r.Button,{onClick:n.is_read?f:h,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"-ml-1 text-lg"}),"Mark as ",n.is_read?"Unread":"Read"]})}),route().current("chats.*")?e.jsx(r.Button,{onClick:B,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{}),"Archive Chat"]})}):e.jsx(r.Button,{onClick:A,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{}),"Unarchive Chat"]})}),e.jsx(r.Button,{onClick:T,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{}),"Delete Chat"]})}),i.id!==n.id&&n.chat_type===v.CHATS&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"my-2 border-secondary"}),e.jsx(r.Button,{onClick:n.is_contact_blocked?M:R,children:n.is_contact_blocked?e.jsxs("div",{className:"flex items-center gap-2 text-success",children:[e.jsx(N,{}),"Unblock Contact"]}):e.jsxs("div",{className:"flex items-center gap-2 text-danger",children:[e.jsx(N,{}),"Block Contact"]})})]}),i.id!==n.id&&n.chat_type===v.GROUP_CHATS&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"my-2 border-secondary"}),e.jsx(r.Button,{onClick:O,children:e.jsxs("div",{className:"flex items-center gap-2 text-danger",children:[e.jsx(K,{}),"Exit Group"]})})]})]})]})};function ae({search:n,href:i,className:l}){const{syncNotification:c}=k(),{chats:o,setChats:x,paginate:t,setPaginate:p}=y(),{ref:d,inView:m}=U();b.useEffect(()=>{m&&d.length>0&&t.next_page_url&&z(t.next_page_url).then(s=>{p(s.data.data),x([...o,...s.data.data.data])})},[m,t]);const u=s=>{s.is_read||w(s).then(c)};if(o.length!==0)return e.jsxs("div",{className:g("relative max-h-[calc(100vh_-_158px)] flex-1 overflow-y-auto px-2 sm:max-h-max sm:pb-2",l),children:[o.sort((s,h)=>{var f;return n.length===0?(f=h.created_at)==null?void 0:f.localeCompare(s.created_at):s.name.localeCompare(h.name)}).map(s=>e.jsxs("div",{className:"group relative flex items-center",children:[e.jsx(I,{href:route(i,s.id),as:"button",onClick:()=>u(s),className:g("relative flex w-full flex-1 items-center gap-3 rounded-lg p-3 text-left transition-all group-hover:bg-secondary",route().current(i,s.id)&&"bg-secondary",s.is_contact_blocked&&"opacity-25"),children:n.length===0&&s.created_at?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative shrink-0",children:[e.jsx("img",{src:s.avatar,alt:s.name,className:"h-12 w-12 rounded-full border border-secondary"}),s.is_online&&e.jsx(C,{})]}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("h5",{className:"truncate font-medium",children:s.name}),e.jsxs("div",{className:"flex items-center text-sm text-secondary-foreground",children:[e.jsx("p",{className:g("truncate",!s.is_read&&"font-medium text-foreground",route().current(i,s.id)&&"!text-foreground"),dangerouslySetInnerHTML:{__html:s.body}}),e.jsx("span",{className:"mx-1",children:"."}),e.jsx("span",{className:"shrink-0",children:S(s.created_at)})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative shrink-0",children:[e.jsx("img",{src:s.avatar,alt:s.name,className:"h-10 w-10 rounded-full border border-secondary"}),s.is_online&&e.jsx(C,{})]}),e.jsx("div",{className:"overflow-hidden",children:e.jsx("h5",{className:"truncate font-medium",children:s.name})})]})}),s.body&&e.jsx(Q,{chat:s}),!s.is_read&&e.jsx(J,{})]},s.id)),t.next_page_url&&e.jsx("button",{className:"mx-auto mt-4 flex",ref:d,children:e.jsx(Y,{className:"animate-spin text-2xl text-secondary-foreground"})})]})}export{ae as C};
