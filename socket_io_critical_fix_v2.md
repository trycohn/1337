# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï Socket.IO v2.0 - Connection Refused ‚Üí –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

## üìä –°–¢–ê–¢–£–°: üîç –î–ò–ê–ì–ù–û–°–¢–ò–ß–ï–°–ö–ê–Ø –í–ï–†–°–ò–Ø

### ‚ùå **–ü–†–û–ë–õ–ï–ú–ê –í–´–Ø–í–õ–ï–ù–ê:**
```
WebSocket connection to 'wss://1337community.com/socket.io/' failed
Nginx: connect() failed (111: Connection refused) while connecting to upstream
Backend –ª–æ–≥–∏: –ù–ï–¢ —Å–æ–æ–±—â–µ–Ω–∏–π –æ Socket.IO –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
```

**–î–∏–∞–≥–Ω–æ–∑**: Socket.IO —Å–µ—Ä–≤–µ—Ä **–ù–ï –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è** –∏–ª–∏ **–ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏**.

### üõ†Ô∏è **–ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø V2.0:**

#### 1. ‚úÖ **–ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏** (`backend/server.js`):
```javascript
// üîå –≠–¢–ê–ü 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Socket.IO
console.log('üîå –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Socket.IO —Å–µ—Ä–≤–µ—Ä–∞...');
const io = new SocketIOServer(server, { /* –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è */ });
console.log('‚úÖ Socket.IO —Å–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞–Ω');

// üîê –≠–¢–ê–ü 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
console.log('üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Socket.IO...');
io.use(async (socket, next) => {
    console.log('üîç Socket.IO: –ø–æ–ø—ã—Ç–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
    // ... middleware –∫–æ–¥
});
console.log('‚úÖ Middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Socket.IO –Ω–∞—Å—Ç—Ä–æ–µ–Ω');

// üîå –≠–¢–ê–ü 3: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞
console.log('üîå –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞ —á–µ—Ä–µ–∑ Socket.IO...');
setupChatSocketIO(io);
console.log('‚úÖ –ß–∞—Ç Socket.IO –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');

// ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –≠–¢–ê–ü
console.log('‚úÖ Socket.IO –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!');
```

#### 2. ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π**:
```javascript
// –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Socket.IO
io.engine.on('connection_error', (err) => {
  console.log('‚ùå Socket.IO connection_error:', err.req);
  console.log('‚ùå Socket.IO connection_error code:', err.code);
  console.log('‚ùå Socket.IO connection_error message:', err.message);
});
```

#### 3. ‚úÖ **–¢–µ—Å—Ç–æ–≤—ã–π endpoint –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏**:
```javascript
app.get('/test-socketio', (req, res) => {
  try {
    const io = req.app.get('io');
    if (!io) {
      return res.status(500).json({ 
        status: 'error', 
        message: 'Socket.IO –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω' 
      });
    }
    
    const clientsCount = io.engine.clientsCount;
    const transports = io.engine.opts.transports;
    
    res.json({ 
      status: 'success',
      message: 'Socket.IO —Ä–∞–±–æ—Ç–∞–µ—Ç',
      clientsCount,
      transports
    });
  } catch (error) {
    res.status(500).json({
      status: 'error',
      message: error.message
    });
  }
});
```

#### 4. ‚úÖ **–§–∏–Ω–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏**:
- `deploy_final_socketio_fix.sh` - –ø–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ –∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –ü–æ–∏—Å–∫ Socket.IO –ª–æ–≥–æ–≤ –∏ –æ—à–∏–±–æ–∫
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–∞–ª—å–Ω–µ–π—à–∏–º –¥–µ–π—Å—Ç–≤–∏—è–º

### üéØ **–¶–ï–õ–¨ V2.0:**
–í—ã—è–≤–∏—Ç—å **—Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ –ø–∞–¥–µ–Ω–∏—è** Socket.IO —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

### üìã **–ö–û–ú–ê–ù–î–´ –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Ø:**

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ VDS —Å–µ—Ä–≤–µ—Ä—É
ssh root@80.87.200.23

# –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd /var/www/1337community.com

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç
chmod +x deploy_final_socketio_fix.sh
./deploy_final_socketio_fix.sh
```

### ‚úÖ **–û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´:**

**–ï—Å–ª–∏ Socket.IO –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ:**
```
üîå –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Socket.IO —Å–µ—Ä–≤–µ—Ä–∞...
‚úÖ Socket.IO —Å–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞–Ω
üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Socket.IO...
‚úÖ Middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Socket.IO –Ω–∞—Å—Ç—Ä–æ–µ–Ω
üîå –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞ —á–µ—Ä–µ–∑ Socket.IO...
‚úÖ –ß–∞—Ç Socket.IO –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
‚úÖ Socket.IO —ç–∫–∑–µ–º–ø–ª—è—Ä —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ app
‚úÖ Socket.IO –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!
```

**–¢–µ—Å—Ç–æ–≤—ã–π endpoint:**
```json
{
  "status": "success",
  "message": "Socket.IO —Ä–∞–±–æ—Ç–∞–µ—Ç",
  "clientsCount": 0,
  "transports": ["websocket", "polling"]
}
```

**–ï—Å–ª–∏ Socket.IO –ø–∞–¥–∞–µ—Ç:**
- –õ–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç **—Ç–æ—á–Ω—ã–π —ç—Ç–∞–ø** –≥–¥–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–±–æ–π
- Error –ª–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç **–ø—Ä–∏—á–∏–Ω—É** –ø–∞–¥–µ–Ω–∏—è
- –ú–æ–∂–Ω–æ –±—É–¥–µ—Ç **—Ç–æ—á–µ—á–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å** –ø—Ä–æ–±–ª–µ–º—É

### üîß **–í–û–ó–ú–û–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–®–ï–ù–ò–Ø:**

#### ‚ùå –ï—Å–ª–∏ –ª–æ–≥–∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –Ω–∞ "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Socket.IO —Å–µ—Ä–≤–µ—Ä–∞...":
**–ü—Ä–æ–±–ª–µ–º–∞**: –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Socket.IO —Å–µ—Ä–≤–µ—Ä–∞
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ `socket.io`, –≤–µ—Ä—Å–∏—é Node.js

#### ‚ùå –ï—Å–ª–∏ –ª–æ–≥–∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –Ω–∞ "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...":
**–ü—Ä–æ–±–ª–µ–º–∞**: –û—à–∏–±–∫–∞ –≤ middleware —Ñ—É–Ω–∫—Ü–∏–∏
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JWT –±–∏–±–ª–∏–æ—Ç–µ–∫—É, –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

#### ‚ùå –ï—Å–ª–∏ –ª–æ–≥–∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –Ω–∞ "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞...":
**–ü—Ä–æ–±–ª–µ–º–∞**: –û—à–∏–±–∫–∞ –≤ `chat-socketio.js`
**–†–µ—à–µ–Ω–∏–µ**: –í—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `setupChatSocketIO(io)`

### üìÅ **–§–ê–ô–õ–´ –ò–ó–ú–ï–ù–ï–ù–´:**
- `backend/server.js` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Socket.IO
- `deploy_final_socketio_fix.sh` - —Å–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- `socket_io_critical_fix_v2.md` - –¥–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**üéØ –†–ï–ó–£–õ–¨–¢–ê–¢: –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ –º—ã —Ç–æ—á–Ω–æ —É–∑–Ω–∞–µ–º –≥–¥–µ –∏ –ø–æ—á–µ–º—É –ø–∞–¥–∞–µ—Ç Socket.IO!** 