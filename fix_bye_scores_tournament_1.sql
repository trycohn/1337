-- ========================================
-- –£–°–¢–ê–ù–û–í–ö–ê –°–ò–ú–í–û–õ–ò–ß–ï–°–ö–û–ì–û –°–ß–ï–¢–ê –î–õ–Ø BYE vs BYE –ú–ê–¢–ß–ï–ô
-- ========================================

-- üéØ –¶–ï–õ–¨: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–π —Å—á–µ—Ç 1:0 –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö BYE vs BYE –º–∞—Ç—á–µ–π
-- –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

-- –®–ê–ì 1: –ê–ù–ê–õ–ò–ó –¢–ï–ö–£–©–ò–• BYE vs BYE –ú–ê–¢–ß–ï–ô
-- ========================================

SELECT 
    'üìä –¢–ï–ö–£–©–ò–ï BYE vs BYE –ú–ê–¢–ß–ò:' as info,
    match_number,
    round,
    team1_id,
    team2_id,
    score1,
    score2,
    winner_team_id,
    status,
    CASE 
        WHEN score1 = 0 AND score2 = 0 AND status = 'completed' THEN 'üîÑ –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞ 1:0'
        WHEN score1 = 1 AND score2 = 0 AND status = 'completed' THEN '‚úÖ –£–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ'
        ELSE '‚ùì –ü—Ä–æ–≤–µ—Ä–∏—Ç—å'
    END as action_needed
FROM matches 
WHERE tournament_id = 1
    AND team1_id IS NULL 
    AND team2_id IS NULL
ORDER BY round, match_number;

-- –®–ê–ì 2: –ù–ê–ß–ê–õ–û –¢–†–ê–ù–ó–ê–ö–¶–ò–ò
-- ========================================

BEGIN;

-- –®–ê–ì 3: –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–ß–ï–¢–ê BYE vs BYE –ú–ê–¢–ß–ï–ô
-- ========================================

-- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–π —Å—á–µ—Ç 1:0 –¥–ª—è BYE vs BYE –º–∞—Ç—á–µ–π
UPDATE matches 
SET 
    score1 = 1,
    score2 = 0
WHERE tournament_id = 1
    AND team1_id IS NULL 
    AND team2_id IS NULL
    AND status = 'completed'
    AND (score1 = 0 AND score2 = 0);

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
SELECT 
    '‚úÖ –û–ë–ù–û–í–õ–ï–ù–û BYE vs BYE –ú–ê–¢–ß–ï–ô:' as info,
    COUNT(*) as updated_matches
FROM matches 
WHERE tournament_id = 1
    AND team1_id IS NULL 
    AND team2_id IS NULL
    AND status = 'completed'
    AND score1 = 1 
    AND score2 = 0;

-- –®–ê–ì 4: –ü–†–û–í–ï–†–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í
-- ========================================

-- –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö BYE –º–∞—Ç—á–µ–π
SELECT 
    'üîç –§–ò–ù–ê–õ–¨–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï BYE –ú–ê–¢–ß–ï–ô:' as section,
    match_number,
    round,
    CASE 
        WHEN team1_id IS NULL AND team2_id IS NULL THEN 'BYE vs BYE'
        WHEN team1_id IS NULL THEN 'BYE vs –ö–æ–º–∞–Ω–¥–∞'
        WHEN team2_id IS NULL THEN '–ö–æ–º–∞–Ω–¥–∞ vs BYE'
        ELSE '–û–±—ã—á–Ω—ã–π –º–∞—Ç—á'
    END as match_type,
    score1,
    score2,
    status,
    CASE 
        WHEN team1_id IS NULL AND team2_id IS NULL AND score1 = 1 AND score2 = 0 THEN '‚úÖ –°–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–π —Å—á–µ—Ç'
        WHEN team1_id IS NULL AND team2_id IS NULL AND score1 = 0 AND score2 = 0 THEN '‚ùå –ù—É–ª–µ–≤–æ–π —Å—á–µ—Ç'
        WHEN status = 'completed' THEN '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω'
        ELSE '‚è≥ –í –ø—Ä–æ—Ü–µ—Å—Å–µ'
    END as display_status
FROM matches 
WHERE tournament_id = 1
    AND (team1_id IS NULL OR team2_id IS NULL)
ORDER BY round, match_number;

-- –®–ê–ì 5: –í–õ–ò–Ø–ù–ò–ï –ù–ê FRONTEND
-- ========================================

SELECT 
    'üé® –í–õ–ò–Ø–ù–ò–ï –ù–ê –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï:' as section,
    '–°–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–π —Å—á–µ—Ç 1:0 –ø–æ–º–æ–∂–µ—Ç frontend –ø–æ–Ω—è—Ç—å —á—Ç–æ –º–∞—Ç—á –∑–∞–≤–µ—Ä—à–µ–Ω' as benefit1,
    'BYE vs BYE –º–∞—Ç—á–∏ –±—É–¥—É—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Å—Ç–∞—Ç—É—Å' as benefit2,
    '–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å "‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω" –≤–º–µ—Å—Ç–æ "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ"' as benefit3,
    '–°—á–µ—Ç 1:0 —è–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –¥–ª—è BYE –ø–æ–±–µ–¥ –≤ —Å–ø–æ—Ä—Ç–µ' as benefit4;

-- –®–ê–ì 6: –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï –ò–õ–ò –û–¢–ö–ê–¢
-- ========================================

-- –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –æ–¥–Ω—É –∏–∑ —Å—Ç—Ä–æ–∫ –Ω–∏–∂–µ:
-- COMMIT;    -- ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—á–µ—Ç–∞
-- ROLLBACK;  -- ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

SELECT 'üéØ –í–ù–ò–ú–ê–ù–ò–ï! –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ COMMIT –∏–ª–∏ ROLLBACK –≤—ã—à–µ!' as warning;

-- =========================================
-- –ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–û –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ:
-- =========================================

/*
üéØ –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï:
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–π —Å—á–µ—Ç 1:0 –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö BYE vs BYE –º–∞—Ç—á–µ–π
–≤–º–µ—Å—Ç–æ 0:0, —á—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç frontend –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞—Ç—å —Å—Ç–∞—Ç—É—Å –º–∞—Ç—á–∞.

üìã –ü–û–†–Ø–î–û–ö –í–´–ü–û–õ–ù–ï–ù–ò–Ø:
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–æ —Å—Ç—Ä–æ–∫–∏ BEGIN –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
2. –ò–∑—É—á–∏—Ç–µ –∫–∞–∫–∏–µ –º–∞—Ç—á–∏ –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª–µ–Ω—ã
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤–µ—Å—å —Å–∫—Ä–∏–ø—Ç
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
5. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ COMMIT –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

üé® –û–ñ–ò–î–ê–ï–ú–´–ô –≠–§–§–ï–ö–¢:
- BYE vs BYE –º–∞—Ç—á–∏ –ø–æ–ª—É—á–∞—Ç —Å—á–µ—Ç 1:0 –≤–º–µ—Å—Ç–æ 0:0
- Frontend –±—É–¥–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∏—Ö –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–∫–∞–∂–µ—Ç "‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω" –≤–º–µ—Å—Ç–æ "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ"

‚ö†Ô∏è –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞—Å–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ BYE vs BYE –º–∞—Ç—á–µ–π
- –û–±—ã—á–Ω—ã–µ –º–∞—Ç—á–∏ –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç—Å—è
- –í–æ–∑–º–æ–∂–µ–Ω –æ—Ç–∫–∞—Ç —á–µ—Ä–µ–∑ ROLLBACK
*/