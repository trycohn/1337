#!/bin/bash

# üîß –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Ç—É—Ä–Ω–∏—Ä–Ω–æ–π —Å–µ—Ç–∫–∏
# –î–∞—Ç–∞: $(date)
# –ê–≤—Ç–æ—Ä: QA Engineer

echo "üöÄ –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô –ì–ï–ù–ï–†–ê–¢–û–†–ê –¢–£–†–ù–ò–†–ù–û–ô –°–ï–¢–ö–ò"
echo "======================================================"

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /var/www/1337community.com

echo "üìÅ –¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: $(pwd)"

# –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥ —Å GitHub
echo "‚¨áÔ∏è –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥ —Å GitHub..."
git pull origin main

if [ $? -eq 0 ]; then
    echo "‚úÖ –ö–æ–¥ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
if [ -f "backend/bracketGenerators/singleEliminationV2.js" ]; then
    echo "‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∞–π–¥–µ–Ω"
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ —Ñ–∞–π–ª–∞ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏
    echo "üîç –í–µ—Ä—Å–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞:"
    head -5 backend/bracketGenerators/singleEliminationV2.js | grep -E "(–í–µ—Ä—Å–∏—è|Version)"
else
    echo "‚ùå –§–∞–π–ª –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    exit 1
fi

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º backend —Å–µ—Ä–≤–∏—Å
echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º backend —Å–µ—Ä–≤–∏—Å..."
pm2 restart 1337-backend

if [ $? -eq 0 ]; then
    echo "‚úÖ Backend —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ backend"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
echo "üìä –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤:"
pm2 status

echo ""
echo "‚úÖ –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û!"
echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Ç—É—Ä–Ω–∏—Ä–Ω–æ–π —Å–µ—Ç–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã"
echo "üìç –í–µ—Ä—Å–∏—è: Single Elimination V3.0 —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –º–∞—Ç–µ–º–∞—Ç–∏–∫–æ–π"
echo "" 