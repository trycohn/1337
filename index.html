<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –¢—É—Ä–Ω–∏—Ä–Ω–æ–µ –î–µ—Ä–µ–≤–æ</title>
  <style>
    /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
    body {
      background-color: #000;
      color: #ccc;
      font-family: 'Play', Arial, sans-serif;
      margin: 20px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: #000;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(255,255,255,0.1);
    }
    /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
    h1 { color: #fff; }
    /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ä–∞—É–Ω–¥–æ–≤ ‚Äì –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ —Ü–µ–Ω—Ç—Ä—É, –±–µ–ª—ã–π —Ü–≤–µ—Ç */
    .round-column h2 {
      text-align: center;  /* –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
      color: #fff;
      font-weight: normal;
    }
    /* –î–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –º–∞—Ç—á–∞ –∏ –º–∞—Ç—á–∞ –∑–∞ 3-–µ –º–µ—Å—Ç–æ ‚Äì –∫—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç */
    .final-label { color: red; }
    /* –°—Ç–∏–ª–∏ —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ */
    #registrationSection {
      border: 1px solid #444;
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 4px;
      background-color: #000;
    }
    #registrationSection input[type="text"] {
      padding: 4px;
      margin-right: 5px;
      width: 200px;
      background-color: #151515;
      color: #ccc;
      border: 1px solid #444;
    }
    #registeredTeamsList li { color: #ccc; }
    /* –ß–µ–∫–±–æ–∫—Å */
    #thirdMatchCheckboxContainer {
      margin-bottom: 10px;
      color: #ccc;
    }
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ ‚Äì –∫–ª–∞—Å—Å v15 */
    &.v15{

&:hover{
  .icon{
    transform: scale(0.9) skew(0deg, 0deg);

    &:before, &:after{
      width: 60px;
    }
    &:before{
      left: calc(50% - 30px);
    }
    &:after{
      right: calc(50% - 30px);
    }

    span {
      &:before, &:after {
        height: calc(100% - 20px);
      }
      &:before{
        top: 10px;
      }
      &:after{
        bottom: 10px;
      }
    }
  }
}

.label{
  padding: 10px 22px;
}

.icon{
  display: block;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  transform: skew(-40deg, 0deg);
  transition: all 0.2s;

  &:before, &:after{
    content: '';
    height: 1px;
    width: 30px;
    position: absolute;
    display: block;
    background: #f0202f;
    transition: all 0.2s;
    transition-delay: 0.2s;
  }
  &:before{
    left: 0;
    top: 0;
  }
  &:after{
    right: 0;
    bottom: 0;
  }
  span{

    &:before, &:after{
      content: '';
      background: #f0202f;
      position: absolute;
      display: block;
      width: 2px;
      height: 30px;
      transition: all 0.2s;
      transition-delay: 0.2s;
    }
    &:before{
      left: 0;
      top: 0;
    }
    &:after{
      right: 0;
      bottom: 0;
    }
  }
}
}

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä–∞—É–Ω–¥–æ–≤ ‚Äì –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ, —Å—Ç–æ–ª–±—Ü—ã –ø–æ 20% */
    .bracket-container {
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      overflow-x: auto;
      margin-top: 20px;
    }
    .round-column {
      width: 20%;  /* —à–∏—Ä–∏–Ω–∞ —Å—Ç–æ–ª–±—Ü–∞ 20% */
      margin: 0 10px;
    }
    .match {
      border: 1px solid #444;
      border-radius: 4px;
      padding: 5px;
      margin-bottom: 20px;
      background-color: #151515;
      text-align: center;
    }
    .match > div:first-child {
      font-size: 12px;
      margin-bottom: 5px;
      color: #ccc;
    }
    .team {
      padding: 5px;
      margin: 5px 0;
      cursor: pointer;
      border: 1px solid #444;
      border-radius: 4px;
      background-color: #151515;
      color: #ccc;
    }
    .team:hover { background-color: #212121; }
    .tbd { color: #888; font-style: italic; }
    input[type="number"] {
      text-align: center;
      padding: 2px;
      margin: 0 2px;
      background-color: #212121;
      color: #ccc;
      border: 1px solid #444;
    }
    .confirm-btn {
      background-color: #cbcbcb;
      color: #000;
      border: none;
      border-radius: 4px;
      padding: 2px 6px;
      cursor: pointer;
      font-size: 14px;
    }
    .confirm-btn.confirmed { background-color: #000; color: #fff; }
    .score-container {
      display: flex;
      align-items: center;
      margin-top: 5px;
    }
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ –ø—Ä–∏–∑—ë—Ä–æ–≤ */
    .prize-list {
      margin-top: 20px;
      color: #ccc;
    }
    .prize-list .first-prize {
      color: red;
      font-weight: bold;
    }
    .medal {
      vertical-align: middle;
      height: 1em;
      margin-left: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –¢—É—Ä–Ω–∏—Ä–Ω–æ–µ –î–µ—Ä–µ–≤–æ</h1>
    <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–æ–º–∞–Ω–¥ -->
    <div id="registrationSection">
      <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥</h2>
      <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã:
        <input type="text" id="teamNameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã">
      </label>
      <label>–ì–æ—Ä–æ–¥:
        <input type="text" id="teamCityInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥">
      </label>
      <button id="registerTeamButton" class="v15">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
      <h3>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã</h3>
      <ul id="registeredTeamsList"></ul>
    </div>
    <!-- –ß–µ–∫–±–æ–∫—Å –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –º–∞—Ç—á–∞ –∑–∞ 3-–µ –º–µ—Å—Ç–æ -->
    <div id="thirdMatchCheckboxContainer">
      <label><input type="checkbox" id="thirdMatchCheckbox" checked> –ù—É–∂–µ–Ω –º–∞—Ç—á –∑–∞ —Ç—Ä–µ—Ç—å–µ –º–µ—Å—Ç–æ?</label>
    </div>
    <button id="generateButton" class="v15">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–∫—É</button>
    <div id="error" class="error"></div>
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–µ—Ç–∫–∏ —Ç—É—Ä–Ω–∏—Ä–∞ -->
    <div id="bracketContainer" class="bracket-container"></div>
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–ø–∏—Å–∫–∞ –ø—Ä–∏–∑—ë—Ä–æ–≤ -->
    <div id="podiumContainer" class="prize-list"></div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {

      /***** –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ *****/
      let registeredTeams = [];
      document.getElementById("registerTeamButton").addEventListener("click", function() {
        const teamNameInput = document.getElementById("teamNameInput");
        const teamCityInput = document.getElementById("teamCityInput");
        let teamName = teamNameInput.value.trim();
        let teamCity = teamCityInput.value.trim();
        if (teamName === "" || teamCity === "") {
          alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –∏ –≥–æ—Ä–æ–¥.");
          return;
        }
        registeredTeams.push({ name: teamName, city: teamCity });
        updateRegisteredTeamsList();
        teamNameInput.value = "";
        teamCityInput.value = "";
      });
      function updateRegisteredTeamsList() {
        const list = document.getElementById("registeredTeamsList");
        list.innerHTML = "";
        registeredTeams.forEach(function(team) {
          const li = document.createElement("li");
          li.textContent = team.name + " (" + team.city + ")";
          list.appendChild(li);
        });
      }

      /***** –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–µ—Ç–∫–∏ *****/
      let bracketRounds = [];
      let thirdPlaceMatch = null; // –º–∞—Ç—á –∑–∞ 3-–µ –º–µ—Å—Ç–æ (–µ—Å–ª–∏ –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è)
      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
      }
      function Match(round, index, team1, team2) {
        this.round = round;
        this.index = index;
        this.team1 = team1;
        this.team2 = team2;
        this.winner = null;
        this.nextMatch = null;
        this.nextMatchSlot = null;
        this.score1 = null;
        this.score2 = null;
        this.scoreConfirmed = false;
      }
      function buildBracket(teams) {
        let n = teams.length;
        if (n < 2) throw new Error("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –º–∏–Ω–∏–º—É–º 2 –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞.");
        let rounds = [];
        let shuffledTeams = teams.slice();
        shuffleArray(shuffledTeams);
        let p = Math.pow(2, Math.floor(Math.log2(n)));
        let preliminaryRound = null;
        let mainRound1Teams = [];
        if (n === p) {
          mainRound1Teams = shuffledTeams;
        } else {
          let numPrelimMatches = n - p;
          let numPrelimTeams = 2 * numPrelimMatches;
          let prelimTeams = shuffledTeams.slice(0, numPrelimTeams);
          let byeTeams = shuffledTeams.slice(numPrelimTeams);
          preliminaryRound = [];
          for (let i = 0; i < numPrelimMatches; i++) {
            let match = new Match(0, i, prelimTeams[2 * i], prelimTeams[2 * i + 1]);
            preliminaryRound.push(match);
          }
          rounds.push(preliminaryRound);
          let byeCount = byeTeams.length;
          mainRound1Teams = [];
          for (let i = 0; i < p; i++) {
            if (i < byeCount) {
              mainRound1Teams.push(byeTeams[i]);
            } else {
              mainRound1Teams.push(null);
            }
          }
        }
        let mainRound1Matches = [];
        for (let i = 0; i < mainRound1Teams.length; i += 2) {
          let roundNum = preliminaryRound ? 1 : 0;
          let match = new Match(roundNum, mainRound1Matches.length, mainRound1Teams[i], mainRound1Teams[i + 1]);
          mainRound1Matches.push(match);
        }
        rounds.push(mainRound1Matches);
        if (preliminaryRound) {
          let byeCountVal = mainRound1Teams.length - preliminaryRound.length;
          for (let j = 0; j < preliminaryRound.length; j++) {
            let slot = byeCountVal + j;
            let matchIndex = Math.floor(slot / 2);
            let slotName = (slot % 2 === 0) ? 'team1' : 'team2';
            preliminaryRound[j].nextMatch = mainRound1Matches[matchIndex];
            preliminaryRound[j].nextMatchSlot = slotName;
          }
        }
        let mainRoundMatches = rounds[rounds.length - 1];
        let totalMainTeams = n === p ? n : mainRound1Teams.length;
        let mainRoundsCount = Math.log2(totalMainTeams);
        let remainingRounds = mainRoundsCount - 1;
        while (remainingRounds > 0) {
          let prevRound = mainRoundMatches;
          let nextRoundMatches = [];
          for (let i = 0; i < prevRound.length; i += 2) {
            let match = new Match(rounds.length, nextRoundMatches.length, null, null);
            nextRoundMatches.push(match);
            prevRound[i].nextMatch = match;
            prevRound[i].nextMatchSlot = 'team1';
            if (i + 1 < prevRound.length) {
              prevRound[i + 1].nextMatch = match;
              prevRound[i + 1].nextMatchSlot = 'team2';
            }
          }
          rounds.push(nextRoundMatches);
          mainRoundMatches = nextRoundMatches;
          remainingRounds--;
        }
        // –ï—Å–ª–∏ n>=4 –∏ —á–µ–∫–±–æ–∫—Å –æ—Ç–º–µ—á–µ–Ω, –¥–æ–±–∞–≤–ª—è–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–∞—É–Ω–¥ –¥–ª—è –º–∞—Ç—á–∞ –∑–∞ 3-–µ –º–µ—Å—Ç–æ
        const needThirdMatch = document.getElementById("thirdMatchCheckbox").checked;
        if (needThirdMatch && n >= 4) {
          const thirdPlaceRound = [];
          const thirdMatch = new Match(rounds.length, 0, null, null);
          thirdPlaceRound.push(thirdMatch);
          rounds.push(thirdPlaceRound);
        }
        return rounds;
      }

      /***** –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ *****/
      function propagate(match) {
        if (match.nextMatch) {
          let next = match.nextMatch;
          if (match.nextMatchSlot === 'team1') {
            next.team1 = match.winner;
          } else {
            next.team2 = match.winner;
          }
          if (next.winner && next.winner !== next.team1 && next.winner !== next.team2) {
            next.winner = null;
            propagate(next);
          }
        }
      }

      /***** –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è *****/
      function setMatchWinner(match, winner) {
        if (match.winner === winner) return;
        if (match.nextMatch && ((match.nextMatch.score1 !== null && match.nextMatch.score1 !== "") ||
            (match.nextMatch.score2 !== null && match.nextMatch.score2 !== ""))) {
          alert("–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª—è, —Ç–∞–∫ –∫–∞–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–∞—Ç—á–∞ —É–∂–µ –≤–≤–µ–¥–µ–Ω—ã.");
          return;
        }
        if (match.winner && match.winner !== winner) {
          if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª—è —Å ${match.winner} –Ω–∞ ${winner}?`))
            return;
          match.scoreConfirmed = false;
        }
        match.winner = winner;
        propagate(match);
        renderBracket();
      }

      /***** –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –∫–æ–º–∞–Ω–¥—ã —Å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏ *****/
      function createTeamElem(match, team, slot) {
        const teamDiv = document.createElement("div");
        teamDiv.className = "team";
        teamDiv.textContent = team ? team : "TBD";
        if (!team) teamDiv.classList.add("tbd");
        // –ï—Å–ª–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª—å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω, –∑–∞–¥–∞—ë–º —Ñ–æ–Ω: –ø–æ–±–µ–¥–∏—Ç–µ–ª—å ‚Äì #212121, –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏–π ‚Äì #151515.
        if (match.winner) {
          if (team === match.winner) {
            teamDiv.style.backgroundColor = "#212121";
            teamDiv.style.color = "#fff";
          } else if (team && team !== "TBD") {
            teamDiv.style.backgroundColor = "#151515";
            teamDiv.style.color = "#fff";
          }
        }
        teamDiv.addEventListener("click", function() {
          setMatchWinner(match, team);
        });
        if (match.winner === team && team) teamDiv.classList.add("winner");
        return teamDiv;
      }

      /***** –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–µ—Ç–∫–∏ *****/
      function renderBracket() {
        const container = document.getElementById("bracketContainer");
        container.innerHTML = "";
        const prizeListContainer = document.getElementById("podiumContainer");
        prizeListContainer.innerHTML = "";
        const needThirdMatch = document.getElementById("thirdMatchCheckbox").checked;
        
        // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞—É–Ω–¥ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ç–∫–∏.
        // –ï—Å–ª–∏ —á–µ–∫–±–æ–∫—Å –æ—Ç–º–µ—á–µ–Ω, –≤—ã–≤–æ–¥–∏–º —Ä–∞—É–Ω–¥—ã —Å 0 –¥–æ (bracketRounds.length - 2)
        // –ï—Å–ª–∏ –Ω–µ –æ—Ç–º–µ—á–µ–Ω, –≤—ã–≤–æ–¥–∏–º —Ä–∞—É–Ω–¥—ã —Å 0 –¥–æ (bracketRounds.length - 1)
        let roundsToShow = needThirdMatch ? bracketRounds.length - 2 : bracketRounds.length - 1;
        for (let r = 0; r < roundsToShow; r++) {
          const roundDiv = document.createElement("div");
          roundDiv.className = "round-column";
          const roundTitle = document.createElement("h2");
          roundTitle.style.textAlign = "center";
          roundTitle.style.color = "#fff";
          if (r === 0 && bracketRounds[0][0].round === 0) {
            roundTitle.textContent = "–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—É–Ω–¥";
          } else {
            roundTitle.textContent = `–†–∞—É–Ω–¥ ${r + 1}`;
          }
          roundDiv.appendChild(roundTitle);
          bracketRounds[r].forEach(match => {
            const matchDiv = document.createElement("div");
            matchDiv.className = "match";
            const matchLabel = document.createElement("div");
            matchLabel.textContent = `–ú–∞—Ç—á ${match.round}-${match.index + 1}`;
            matchDiv.appendChild(matchLabel);
            const team1Elem = createTeamElem(match, match.team1, 'team1');
            const team2Elem = createTeamElem(match, match.team2, 'team2');
            matchDiv.appendChild(team1Elem);
            matchDiv.appendChild(team2Elem);
            if (match.team1 && match.team2) {
              const scoreContainer = document.createElement("div");
              scoreContainer.className = "score-container";
              const score1Input = document.createElement("input");
              score1Input.type = "number";
              score1Input.placeholder = "–°—á–µ—Ç 1";
              score1Input.style.width = "40%";
              score1Input.value = match.score1 !== null ? match.score1 : "";
              if (match.scoreConfirmed) score1Input.disabled = true;
              scoreContainer.appendChild(score1Input);
              scoreContainer.appendChild(document.createTextNode(" - "));
              const score2Input = document.createElement("input");
              score2Input.type = "number";
              score2Input.placeholder = "–°—á–µ—Ç 2";
              score2Input.style.width = "40%";
              score2Input.value = match.score2 !== null ? match.score2 : "";
              if (match.scoreConfirmed) score2Input.disabled = true;
              scoreContainer.appendChild(score2Input);
              const confirmButton = document.createElement("button");
              confirmButton.textContent = "‚úî";
              confirmButton.className = "confirm-btn";
              confirmButton.style.marginLeft = "5px";
              confirmButton.addEventListener("click", function() {
                if (match.nextMatch && ((match.nextMatch.score1 !== null && match.nextMatch.score1 !== "") ||
                    (match.nextMatch.score2 !== null && match.nextMatch.score2 !== ""))) {
                  alert("–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å—á—ë—Ç, —Ç–∞–∫ –∫–∞–∫ –≤ —Å–ª–µ–¥—É—é—â–µ–º –º–∞—Ç—á–µ —É–∂–µ –≤–≤–µ–¥–µ–Ω—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.");
                  return;
                }
                let newScore1 = score1Input.value;
                let newScore2 = score2Input.value;
                match.score1 = newScore1;
                match.score2 = newScore2;
                match.scoreConfirmed = true;
                if (parseInt(newScore1) > parseInt(newScore2)) {
                  setMatchWinner(match, match.team1);
                } else if (parseInt(newScore2) > parseInt(newScore1)) {
                  setMatchWinner(match, match.team2);
                } else {
                  match.winner = null;
                }
                renderBracket();
              });
              scoreContainer.appendChild(confirmButton);
              matchDiv.appendChild(scoreContainer);
            }
            roundDiv.appendChild(matchDiv);
          });
          container.appendChild(roundDiv);
        }
        
        // –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü ‚Äì –≤—ã–≤–æ–¥–∏–º –±–ª–æ–∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –º–∞—Ç—á–∞ –∏, –µ—Å–ª–∏ —á–µ–∫–±–æ–∫—Å –æ—Ç–º–µ—á–µ–Ω, –±–ª–æ–∫ –º–∞—Ç—á–∞ –∑–∞ 3-–µ –º–µ—Å—Ç–æ.
        const finalMatchColumn = document.createElement("div");
        finalMatchColumn.className = "round-column";
        finalMatchColumn.style.order = 1;
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Ç—á:
        let finalMatch;
        if (needThirdMatch) {
          // –ï—Å–ª–∏ –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –º–∞—Ç—á –∑–∞ 3-–µ –º–µ—Å—Ç–æ, —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Ç—á –±–µ—Ä–µ–º –∏–∑ –ø—Ä–µ–¥–ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–∞—É–Ω–¥–∞.
          finalMatch = bracketRounds[bracketRounds.length - 2][0];
        } else {
          finalMatch = bracketRounds[bracketRounds.length - 1][0];
        }
        // –ë–ª–æ–∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –º–∞—Ç—á–∞ ‚Äì –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫—Ä–∞—Å–Ω—ã–π, —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω
        const finalMatchDiv = document.createElement("div");
        finalMatchDiv.className = "match";
        const finalTitle = document.createElement("h2");
        finalTitle.textContent = "–§–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Ç—á";
        finalTitle.classList.add("final-label");
        finalTitle.style.textAlign = "center";
        finalMatchDiv.appendChild(finalTitle);
        if (finalMatch) {
          const finalBlock = document.createElement("div");
          finalBlock.className = "match";
          const finalLabel = document.createElement("div");
          finalLabel.textContent = `–ú–∞—Ç—á ${finalMatch.round}-${finalMatch.index + 1}`;
          finalBlock.appendChild(finalLabel);
          const finalTeam1 = createTeamElem(finalMatch, finalMatch.team1, 'team1');
          const finalTeam2 = createTeamElem(finalMatch, finalMatch.team2, 'team2');
          finalBlock.appendChild(finalTeam1);
          finalBlock.appendChild(finalTeam2);
          if (finalMatch.team1 && finalMatch.team2) {
            const finalScoreContainer = document.createElement("div");
            finalScoreContainer.className = "score-container";
            const finalScore1 = document.createElement("input");
            finalScore1.type = "number";
            finalScore1.placeholder = "–°—á–µ—Ç 1";
            finalScore1.style.width = "40%";
            finalScore1.value = finalMatch.score1 !== null ? finalMatch.score1 : "";
            if (finalMatch.scoreConfirmed) finalScore1.disabled = true;
            finalScoreContainer.appendChild(finalScore1);
            finalScoreContainer.appendChild(document.createTextNode(" - "));
            const finalScore2 = document.createElement("input");
            finalScore2.type = "number";
            finalScore2.placeholder = "–°—á–µ—Ç 2";
            finalScore2.style.width = "40%";
            finalScore2.value = finalMatch.score2 !== null ? finalMatch.score2 : "";
            if (finalMatch.scoreConfirmed) finalScore2.disabled = true;
            finalScoreContainer.appendChild(finalScore2);
            const finalConfirm = document.createElement("button");
            finalConfirm.textContent = "‚úî";
            finalConfirm.className = "confirm-btn";
            finalConfirm.style.marginLeft = "5px";
            finalConfirm.addEventListener("click", function() {
              if (finalMatch.nextMatch && ((finalMatch.nextMatch.score1 !== null && finalMatch.nextMatch.score1 !== "") ||
                  (finalMatch.nextMatch.score2 !== null && finalMatch.nextMatch.score2 !== ""))) {
                alert("–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å—á—ë—Ç, —Ç–∞–∫ –∫–∞–∫ –≤ —Å–ª–µ–¥—É—é—â–µ–º –º–∞—Ç—á–µ —É–∂–µ –≤–≤–µ–¥–µ–Ω—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.");
                return;
              }
              let newScore1 = finalScore1.value;
              let newScore2 = finalScore2.value;
              finalMatch.score1 = newScore1;
              finalMatch.score2 = newScore2;
              finalMatch.scoreConfirmed = true;
              if (parseInt(newScore1) > parseInt(newScore2)) {
                setMatchWinner(finalMatch, finalMatch.team1);
              } else if (parseInt(newScore2) > parseInt(newScore1)) {
                setMatchWinner(finalMatch, finalMatch.team2);
              } else {
                finalMatch.winner = null;
              }
              renderBracket();
            });
            finalScoreContainer.appendChild(finalConfirm);
            finalBlock.appendChild(finalScoreContainer);
          }
          finalMatchDiv.appendChild(finalBlock);
        } else {
          finalMatchDiv.textContent = "TBD";
        }
        finalMatchColumn.appendChild(finalMatchDiv);
        
        // –ï—Å–ª–∏ —á–µ–∫–±–æ–∫—Å –æ—Ç–º–µ—á–µ–Ω ‚Äì –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –±–ª–æ–∫ –º–∞—Ç—á–∞ –∑–∞ 3-–µ –º–µ—Å—Ç–æ –ø–æ–¥ —Ñ–∏–Ω–∞–ª—å–Ω—ã–º –º–∞—Ç—á–µ–º
        if (needThirdMatch) {
          const thirdMatchDiv = document.createElement("div");
          thirdMatchDiv.className = "match";
          const thirdTitle = document.createElement("h2");
          thirdTitle.textContent = "–ú–∞—Ç—á –∑–∞ 3-–µ –º–µ—Å—Ç–æ";
          thirdTitle.classList.add("final-label");
          thirdTitle.style.textAlign = "center";
          thirdMatchDiv.appendChild(thirdTitle);
          if (registeredTeams.length === 3) {
            let prelimMatch = bracketRounds[0][0];
            let loser = "TBD";
            if (prelimMatch.team1 && prelimMatch.team2 && prelimMatch.winner) {
              loser = (prelimMatch.winner === prelimMatch.team1) ? prelimMatch.team2 : prelimMatch.team1;
            }
            thirdPlaceMatch = new Match("TP", 0, loser, "TBD");
            thirdPlaceMatch.scoreConfirmed = true;
          } else if (registeredTeams.length > 3) {
            let semifinalRound;
            if (bracketRounds.length >= 3) {
              semifinalRound = bracketRounds[bracketRounds.length - 3];  // –ø–æ–ª—É—Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞—É–Ω–¥
            } else {
              semifinalRound = bracketRounds[bracketRounds.length - 2];
            }
            if (semifinalRound && semifinalRound.length >= 2) {
              const getLoser = match => (match.winner ? (match.winner === match.team1 ? match.team2 : match.team1) : "TBD");
              thirdPlaceMatch = bracketRounds[bracketRounds.length - 1][0];
              thirdPlaceMatch.team1 = getLoser(semifinalRound[0]);
              thirdPlaceMatch.team2 = getLoser(semifinalRound[1]);
            }
          }
          if (thirdPlaceMatch) {
            const tpTeam1Elem = createTeamElem(thirdPlaceMatch, thirdPlaceMatch.team1, 'team1');
            const tpTeam2Elem = createTeamElem(thirdPlaceMatch, thirdPlaceMatch.team2, 'team2');
            thirdMatchDiv.appendChild(tpTeam1Elem);
            thirdMatchDiv.appendChild(tpTeam2Elem);
            if (thirdPlaceMatch.team1 && thirdPlaceMatch.team2) {
              const tpScoreContainer = document.createElement("div");
              tpScoreContainer.className = "score-container";
              const tpScore1Input = document.createElement("input");
              tpScore1Input.type = "number";
              tpScore1Input.placeholder = "–°—á–µ—Ç 1";
              tpScore1Input.style.width = "40%";
              tpScore1Input.value = thirdPlaceMatch.score1 !== null ? thirdPlaceMatch.score1 : "";
              if (thirdPlaceMatch.scoreConfirmed) tpScore1Input.disabled = true;
              tpScoreContainer.appendChild(tpScore1Input);
              tpScoreContainer.appendChild(document.createTextNode(" - "));
              const tpScore2Input = document.createElement("input");
              tpScore2Input.type = "number";
              tpScore2Input.placeholder = "–°—á–µ—Ç 2";
              tpScore2Input.style.width = "40%";
              tpScore2Input.value = thirdPlaceMatch.score2 !== null ? thirdPlaceMatch.score2 : "";
              if (thirdPlaceMatch.scoreConfirmed) tpScore2Input.disabled = true;
              tpScoreContainer.appendChild(tpScore2Input);
              const tpConfirmButton = document.createElement("button");
              tpConfirmButton.textContent = "‚úî";
              tpConfirmButton.className = "confirm-btn";
              tpConfirmButton.style.marginLeft = "5px";
              tpConfirmButton.addEventListener("click", function() {
                if (thirdPlaceMatch.nextMatch && ((thirdPlaceMatch.nextMatch.score1 !== null && thirdPlaceMatch.nextMatch.score1 !== "") ||
                     (thirdPlaceMatch.nextMatch.score2 !== null && thirdPlaceMatch.nextMatch.score2 !== ""))) {
                  alert("–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å—á—ë—Ç, —Ç–∞–∫ –∫–∞–∫ –≤ —Å–ª–µ–¥—É—é—â–µ–º –º–∞—Ç—á–µ —É–∂–µ –≤–≤–µ–¥–µ–Ω—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.");
                  return;
                }
                let newScore1 = tpScore1Input.value;
                let newScore2 = tpScore2Input.value;
                thirdPlaceMatch.score1 = newScore1;
                thirdPlaceMatch.score2 = newScore2;
                thirdPlaceMatch.scoreConfirmed = true;
                if (parseInt(newScore1) > parseInt(newScore2)) {
                  setMatchWinner(thirdPlaceMatch, thirdPlaceMatch.team1);
                } else if (parseInt(newScore2) > parseInt(newScore1)) {
                  setMatchWinner(thirdPlaceMatch, thirdPlaceMatch.team2);
                } else {
                  thirdPlaceMatch.winner = null;
                }
                renderBracket();
              });
              tpScoreContainer.appendChild(tpConfirmButton);
              thirdMatchDiv.appendChild(tpScoreContainer);
            }
            finalMatchColumn.appendChild(thirdMatchDiv);
          }
        }
        
        container.appendChild(finalMatchColumn);
        
        // (–°—Ç–æ–ª–±–µ—Ü –¥–ª—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è —Ç—É—Ä–Ω–∏—Ä–∞ —É–¥–∞–ª—ë–Ω)
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–∑—ë—Ä–æ–≤ —Ç—É—Ä–Ω–∏—Ä–∞
        updatePrizeList();
      }

      /***** –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø—Ä–∏–∑—ë—Ä–æ–≤ *****/
      function updatePrizeList() {
        const prizeListContainer = document.getElementById("podiumContainer");
        prizeListContainer.innerHTML = "";
        let finalMatchForPrize;
        const needThirdMatch = document.getElementById("thirdMatchCheckbox").checked;
        if (needThirdMatch) {
          finalMatchForPrize = bracketRounds[bracketRounds.length - 2][0];
        } else {
          finalMatchForPrize = bracketRounds[bracketRounds.length - 1][0];
        }
        if (!finalMatchForPrize || !finalMatchForPrize.winner) return;
        const firstPlace = finalMatchForPrize.winner;
        const secondPlace = finalMatchForPrize.winner === finalMatchForPrize.team1 ? finalMatchForPrize.team2 : finalMatchForPrize.team1;
        let thirdPlace = "–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ";
        if (needThirdMatch && thirdPlaceMatch && thirdPlaceMatch.winner && thirdPlaceMatch.winner !== "TBD") {
          thirdPlace = thirdPlaceMatch.winner;
        }
        const listHTML = `
          <div class="first-prize">ü•á 1 –º–µ—Å—Ç–æ: ${firstPlace}</div>
          <div>ü•à 2 –º–µ—Å—Ç–æ: ${secondPlace}</div>
          <div>ü•â 3 –º–µ—Å—Ç–æ: ${thirdPlace}</div>
        `;
        prizeListContainer.innerHTML = listHTML;
      }

      /***** –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–∫—É" *****/
      document.getElementById("generateButton").addEventListener("click", function() {
        const errorDiv = document.getElementById("error");
        errorDiv.textContent = "";
        if (registeredTeams.length < 2) {
          errorDiv.textContent = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –º–∏–Ω–∏–º—É–º 2 –∫–æ–º–∞–Ω–¥—ã.";
          return;
        }
        const teams = registeredTeams.map(team => team.name + " (" + team.city + ")");
        try {
          bracketRounds = buildBracket(teams);
          thirdPlaceMatch = null; // —Å–±—Ä–æ—Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–∞—Ç—á–∞ –∑–∞ 3-–µ –º–µ—Å—Ç–æ
          renderBracket();
        } catch (e) {
          errorDiv.textContent = e.message;
        }
      });
    });
  </script>
</body>
</html>
