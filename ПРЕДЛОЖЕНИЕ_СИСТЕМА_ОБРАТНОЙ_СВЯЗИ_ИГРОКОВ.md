# 🎮 СИСТЕМА ОБРАТНОЙ СВЯЗИ МЕЖДУ ИГРОКАМИ
## Краудсорсинг модерации для противодействия нечестной игре

**Дата:** 2 октября 2025  
**Контекст:** Усиление античит-системы через обратную связь от игроков  
**Специфика платформы:** Турнирная система (не постоянный матчмейкинг)

---

## 🎯 КОНТЕКСТ И СПЕЦИФИКА ПЛАТФОРМЫ

### Ключевые особенности 1337 Community:

**✅ Что у нас есть:**
- Турнирная система (разовые события)
- Mix-команды (случайные тиммейты)
- Система лобби для матчей
- Чаты турниров
- Trust Score (базовая проверка Steam)

**❌ Чего НЕТ (в отличие от FACEIT):**
- Постоянный matchmaking (PUG)
- Ежедневные игры одних и тех же людей
- Большая база регулярных игроков (пока)
- Рейтинговая система

### Проблемы для учета:

1. **Низкая частота взаимодействия:**
   - Игроки встречаются 1-2 раза (в турнире)
   - Не постоянная база как в PUG-системах

2. **Малое количество матчей на пользователя:**
   - В турнире: 3-7 матчей
   - Недостаточно данных для статистики

3. **Риск abuse:**
   - Соперники могут массово репортить из мести
   - Тиммейты могут сговориться против одного игрока

4. **Мотивация:**
   - Зачем игроку тратить время на обратную связь?
   - Нужна reward система

---

## 💡 ВАРИАНТ 1: POST-MATCH FEEDBACK (Базовый)

### 📋 Концепция:

После каждого завершенного матча игрокам показывается **краткая форма обратной связи** на соперников и тиммейтов с простыми вопросами и быстрым выбором.

### 🎨 UI/UX:

```
┌──────────────────────────────────────────────────┐
│  ✅ Матч завершен!                               │
│  Team Alpha 16:14 Team Bravo                     │
├──────────────────────────────────────────────────┤
│                                                   │
│  📊 Как прошла игра?                             │
│                                                   │
│  Оцените ваших СОПЕРНИКОВ:                       │
│  ┌────────────────────────────────────────────┐  │
│  │ PlayerName1 (Team Bravo)                   │  │
│  │                                            │  │
│  │ Честность игры:                            │  │
│  │ 😊 Чисто  😐 Норм  😠 Подозрительно  ☠️ Чит│  │
│  │                                            │  │
│  │ Поведение:                                 │  │
│  │ 👍 Отлично  😐 Норм  👎 Токсично          │  │
│  └────────────────────────────────────────────┘  │
│                                                   │
│  Оцените ваших ТИММЕЙТОВ:                        │
│  ┌────────────────────────────────────────────┐  │
│  │ Teammate2 (Team Alpha)                     │  │
│  │                                            │  │
│  │ Командная игра:                            │  │
│  │ 👍 Отлично  😐 Норм  👎 Плохо             │  │
│  │                                            │  │
│  │ Коммуникация:                              │  │
│  │ 💬 Хорошо  😐 Норм  🔇 Молчал  😠 Токсик │  │
│  └────────────────────────────────────────────┘  │
│                                                   │
│  [⏭️ Пропустить]          [✅ Отправить (+10 🪙)]│
└──────────────────────────────────────────────────┘
```

### 📊 Собираемые данные:

**Для противников:**
```javascript
{
  suspect_fairness: "clean" | "normal" | "suspicious" | "cheating",
  behavior: "good" | "normal" | "toxic"
}
```

**Для тиммейтов:**
```javascript
{
  teamplay: "excellent" | "normal" | "poor",
  communication: "good" | "normal" | "silent" | "toxic"
}
```

### 🗄️ Структура БД:

```sql
-- Таблица обратной связи после матча
CREATE TABLE match_feedback (
  id SERIAL PRIMARY KEY,
  match_id INTEGER REFERENCES matches(id),
  reviewer_id INTEGER REFERENCES users(id),  -- Кто оценивает
  reviewed_id INTEGER REFERENCES users(id),  -- Кого оценивают
  
  -- Тип оценки
  feedback_type VARCHAR(20) CHECK (
    feedback_type IN ('opponent', 'teammate')
  ),
  
  -- Оценки
  fairness_rating VARCHAR(20) CHECK (
    fairness_rating IN ('clean', 'normal', 'suspicious', 'cheating', NULL)
  ),
  behavior_rating VARCHAR(20) CHECK (
    behavior_rating IN ('good', 'normal', 'toxic', NULL)
  ),
  teamplay_rating VARCHAR(20) CHECK (
    teamplay_rating IN ('excellent', 'normal', 'poor', NULL)
  ),
  communication_rating VARCHAR(20) CHECK (
    communication_rating IN ('good', 'normal', 'silent', 'toxic', NULL)
  ),
  
  -- Meta
  created_at TIMESTAMP DEFAULT NOW(),
  
  -- Уникальность: один игрок может оценить другого только раз за матч
  UNIQUE(match_id, reviewer_id, reviewed_id)
);

-- Индексы
CREATE INDEX idx_feedback_reviewed ON match_feedback(reviewed_id);
CREATE INDEX idx_feedback_match ON match_feedback(match_id);
CREATE INDEX idx_feedback_fairness ON match_feedback(fairness_rating);

-- Агрегированная статистика игрока
CREATE TABLE player_reputation (
  user_id INTEGER PRIMARY KEY REFERENCES users(id),
  
  -- Счетчики
  total_feedbacks INTEGER DEFAULT 0,
  
  -- Честность (главный показатель)
  clean_reports INTEGER DEFAULT 0,
  normal_reports INTEGER DEFAULT 0,
  suspicious_reports INTEGER DEFAULT 0,
  cheating_reports INTEGER DEFAULT 0,
  
  -- Поведение
  good_behavior INTEGER DEFAULT 0,
  normal_behavior INTEGER DEFAULT 0,
  toxic_behavior INTEGER DEFAULT 0,
  
  -- Командная игра
  excellent_teamplay INTEGER DEFAULT 0,
  normal_teamplay INTEGER DEFAULT 0,
  poor_teamplay INTEGER DEFAULT 0,
  
  -- Вычисляемые показатели
  fairness_score DECIMAL(5,2), -- 0.00-100.00
  behavior_score DECIMAL(5,2), -- 0.00-100.00
  teamplay_score DECIMAL(5,2), -- 0.00-100.00
  
  -- Репутационный индекс (общий)
  reputation_index INTEGER CHECK (reputation_index BETWEEN 0 AND 100),
  
  updated_at TIMESTAMP DEFAULT NOW()
);
```

### ⚙️ Алгоритм расчета Reputation Index:

```javascript
function calculateReputationIndex(stats) {
  const total = stats.total_feedbacks;
  
  if (total < 5) {
    return 50; // Нейтральный для новичков
  }
  
  // 1. Fairness Score (вес 60% - самое важное)
  const fairnessScore = (
    (stats.clean_reports * 100) +
    (stats.normal_reports * 75) +
    (stats.suspicious_reports * 25) +
    (stats.cheating_reports * 0)
  ) / total;
  
  // 2. Behavior Score (вес 25%)
  const behaviorScore = (
    (stats.good_behavior * 100) +
    (stats.normal_behavior * 60) +
    (stats.toxic_behavior * 0)
  ) / total;
  
  // 3. Teamplay Score (вес 15%)
  const teamplayScore = (
    (stats.excellent_teamplay * 100) +
    (stats.normal_teamplay * 60) +
    (stats.poor_teamplay * 20)
  ) / total;
  
  // Взвешенная сумма
  const reputationIndex = Math.round(
    (fairnessScore * 0.6) +
    (behaviorScore * 0.25) +
    (teamplayScore * 0.15)
  );
  
  return Math.max(0, Math.min(100, reputationIndex));
}
```

### 🎮 Интеграция в турниры:

```javascript
// После сохранения результата матча
async function onMatchComplete(matchId) {
  // Получить всех участников
  const participants = await getMatchParticipants(matchId);
  
  // Отправить уведомления с просьбой оценить
  for (const player of participants) {
    await sendNotification(player.user_id, {
      type: 'match_feedback_request',
      match_id: matchId,
      message: 'Оцените игроков в завершенном матче (+10 coins)'
    });
  }
}
```

### 💰 Мотивация:

**Rewards за заполнение:**
- 10 coins за каждый feedback
- Бонус 50 coins за 10 feedbacks
- Badge "Честный судья" за 100 feedbacks
- Приоритет в модерации (вес голоса выше)

### 📈 Использование данных:

**Автоматические действия:**
```javascript
// Если 5+ игроков пожаловались на читинг за последние 10 матчей
if (cheatingReports >= 5 && totalMatches <= 10) {
  // 1. Флаг для модерации
  await flagForReview(userId, 'Multiple cheating reports');
  
  // 2. Снизить Trust Score
  await adjustTrustScore(userId, -20);
  
  // 3. Уведомить админов
  await notifyAdmins(`User ${username} flagged: 5+ cheating reports`);
}

// Если репутация упала < 30
if (reputationIndex < 30) {
  // Ограничения
  restrictFromPremiumTournaments(userId);
  requireManualVerification(userId);
}
```

---

## 🎯 АРГУМЕНТЫ ЗА И ПРОТИВ

### ✅ ПЛЮСЫ:

1. **Простота реализации:**
   - Легкий UI (4 кнопки)
   - Простая БД (2 таблицы)
   - Быстрая интеграция (1-2 дня)

2. **Низкий порог входа:**
   - Не требует экспертизы от игроков
   - Быстрое заполнение (30 секунд)
   - Эмоджи = понятно для всех

3. **Мотивация:**
   - Награда coins (геймификация)
   - Влияние на комьюнити
   - Быстрая обратная связь

4. **Масштабируемость:**
   - Работает с первого матча
   - Не требует большой базы игроков
   - Данные накапливаются постепенно

5. **Интеграция с Trust Score:**
   - Дополняет Steam Trust Factor
   - Ловит читеров без VAC бана
   - Community-driven подход

### ❌ МИНУСЫ:

1. **Риск abuse:**
   - Соперники могут репортить из мести за проигрыш
   - Друзья могут накручивать положительные отзывы
   - Токсики будут репортить всех

2. **Недостаточно данных:**
   - В турнире всего 3-7 матчей
   - Мало статистики для объективности
   - Нужно много времени на накопление

3. **Субъективность:**
   - "Читер" vs "Просто скилл"
   - Эмоции после проигрыша
   - Разное понимание токсичности

4. **Игнорирование пользователями:**
   - Многие будут пропускать
   - Low completion rate (30-40%)
   - Нужны сильные стимулы

5. **Нагрузка на модерацию:**
   - Нужно проверять каждый репорт
   - Отсеивать false-positive
   - Время на расследование

### 🎯 ОЦЕНКА:

**Сложность:** ⭐⭐ (2/5) - Легко  
**Стоимость:** $3,000-5,000 (1-2 недели)  
**Эффективность:** ⭐⭐⭐ (3/5) - Средняя  
**ROI:** ⭐⭐⭐⭐ (4/5) - Хороший  

**Рекомендация:** ✅ **ПОДХОДИТ** как быстрый старт, но требует доработки

---

## 💡 ВАРИАНТ 2: SMART REPUTATION SYSTEM (Расширенный)

### 📋 Концепция:

**Умная система репутации** с взвешенным голосованием, автоматической фильтрацией abuse и интеграцией с Trust Score. Комбинирует простоту Варианта 1 с продвинутыми алгоритмами защиты от накруток.

### 🎨 UI/UX:

```
┌──────────────────────────────────────────────────┐
│  🏆 Матч завершен!                               │
│  Спасибо за игру! Помогите улучшить платформу   │
├──────────────────────────────────────────────────┤
│                                                   │
│  📊 Быстрая оценка (15 сек, +15 🪙)              │
│                                                   │
│  Соперники (Team Bravo):                         │
│  ┌────────────────────────────────────────────┐  │
│  │ EnemyPlayer1                   🔍 Детально │  │
│  │ [😊 Чисто] [😐 Норм] [⚠️ Подозрительно]   │  │
│  └────────────────────────────────────────────┘  │
│                                                   │
│  Тиммейты (Team Alpha):                          │
│  ┌────────────────────────────────────────────┐  │
│  │ Teammate1                      🔍 Детально │  │
│  │ [👍 Хорошо] [😐 Норм] [👎 Плохо]          │  │
│  └────────────────────────────────────────────┘  │
│                                                   │
│  [⏭️ Пропустить]              [✅ Отправить]     │
└──────────────────────────────────────────────────┘

При клике "🔍 Детально":

┌──────────────────────────────────────────────────┐
│  📋 Детальная оценка: PlayerName1                │
├──────────────────────────────────────────────────┤
│                                                   │
│  🎯 Честность:                                   │
│  ○ Чистая игра                                   │
│  ○ Подозрительные моменты                        │
│  ● Явный читинг (ВАЖНО: выберите тип)            │
│                                                   │
│  Если подозрение на чит:                         │
│  ☑️ Aimbot (неестественная точность)             │
│  ☑️ Wallhack (знает позиции через стены)         │
│  ☐ Triggerbot (мгновенная реакция)               │
│  ☐ Other                                         │
│                                                   │
│  Раунды с подозрительными моментами:             │
│  [Раунд 5] [Раунд 12] [Раунд 16]                 │
│                                                   │
│  Дополнительные комментарии:                     │
│  ┌────────────────────────────────────────────┐  │
│  │ Headshot только, prefiring каждый угол     │  │
│  └────────────────────────────────────────────┘  │
│                                                   │
│  ⚠️ Ложные обвинения наказываются!              │
│  Ваша репутация: 87/100 ✅                       │
│                                                   │
│  [Отмена]                        [Отправить]     │
└──────────────────────────────────────────────────┘
```

### 🧠 Умные алгоритмы защиты от abuse:

#### 1. Weighted Voting (Взвешенное голосование):

```javascript
function calculateReportWeight(reviewer) {
  let weight = 1.0; // Базовый вес
  
  // Факторы увеличения веса:
  
  // 1. Репутация самого reviewer
  if (reviewer.reputation_index > 80) weight += 0.5;
  else if (reviewer.reputation_index < 30) weight -= 0.5;
  
  // 2. Trust Score reviewer
  if (reviewer.trust_score > 80) weight += 0.3;
  else if (reviewer.trust_score < 40) weight -= 0.3;
  
  // 3. История точности репортов
  const accuracy = reviewer.accurate_reports / reviewer.total_reports;
  if (accuracy > 0.8) weight += 0.4; // 80%+ точных
  else if (accuracy < 0.5) weight -= 0.6; // <50% точных
  
  // 4. Опыт (количество матчей)
  if (reviewer.matches_played > 100) weight += 0.2;
  else if (reviewer.matches_played < 10) weight -= 0.2;
  
  // 5. Результат матча (проигравшие репортят чаще)
  if (reviewer.lost_this_match) weight -= 0.1;
  
  // Минимальный вес 0.1, максимальный 3.0
  return Math.max(0.1, Math.min(3.0, weight));
}
```

#### 2. Abuse Detection (Детекция накруток):

```javascript
async function detectAbuse(reviewerId, reviewedId, matchId) {
  const flags = [];
  
  // Флаг 1: Репортит ВСЕХ соперников как читеров
  const allOpponentsReported = await pool.query(`
    SELECT COUNT(*) as total,
           COUNT(CASE WHEN fairness_rating = 'cheating' THEN 1 END) as cheating
    FROM match_feedback
    WHERE match_id = $1 
      AND reviewer_id = $2 
      AND feedback_type = 'opponent'
  `, [matchId, reviewerId]);
  
  if (allOpponentsReported.rows[0].total === allOpponentsReported.rows[0].cheating) {
    flags.push('reports_all_opponents');
    // Обнулить вес этих репортов
  }
  
  // Флаг 2: Всегда репортит на "читинг" (>80% от всех репортов)
  const reportHistory = await pool.query(`
    SELECT 
      COUNT(*) as total,
      COUNT(CASE WHEN fairness_rating = 'cheating' THEN 1 END) as cheating
    FROM match_feedback
    WHERE reviewer_id = $1
  `, [reviewerId]);
  
  const cheatingRate = reportHistory.rows[0].cheating / reportHistory.rows[0].total;
  if (cheatingRate > 0.8) {
    flags.push('excessive_cheating_reports');
    // Снизить вес репортов в 2 раза
  }
  
  // Флаг 3: Взаимные репорты (перестрелка)
  const mutualReport = await pool.query(`
    SELECT COUNT(*) 
    FROM match_feedback
    WHERE reviewer_id = $1 
      AND reviewed_id = $2
      AND match_id = $3
  `, [reviewedId, reviewerId, matchId]); // Обратный репорт
  
  if (mutualReport.rows[0].count > 0) {
    flags.push('mutual_report');
    // Оба репорта получают вес 0.5
  }
  
  return flags;
}
```

#### 3. Threshold for Action (Пороги для действий):

```javascript
async function checkReportThreshold(userId) {
  const stats = await getPlayerReputation(userId);
  
  // Критический уровень: 5+ взвешенных репортов на читинг
  const weightedCheatingReports = await pool.query(`
    SELECT SUM(
      CASE mf.fairness_rating
        WHEN 'cheating' THEN (
          SELECT calculate_report_weight(mf.reviewer_id)
        )
        ELSE 0
      END
    ) as weighted_sum
    FROM match_feedback mf
    WHERE mf.reviewed_id = $1
      AND mf.created_at > (NOW() - INTERVAL '30 days')
  `, [userId]);
  
  const weightedSum = parseFloat(weightedCheatingReports.rows[0].weighted_sum || 0);
  
  if (weightedSum >= 5.0) {
    // Триггер: флаг для ручной проверки
    await flagForManualReview(userId, {
      reason: 'Multiple weighted cheating reports',
      weighted_sum: weightedSum,
      priority: 'HIGH'
    });
  }
  
  if (weightedSum >= 10.0) {
    // Критический уровень: временный бан + обязательная проверка демо
    await temporaryBan(userId, {
      duration: '7 days',
      reason: 'Pending cheating investigation',
      requires_demo_review: true
    });
  }
}
```

### 📊 Отображение репутации:

**В профиле игрока:**
```
┌──────────────────────────────────────────┐
│  👤 PlayerName                           │
│  Trust Score: 85/100 ✅                  │
│  Reputation: 73/100 🟡                   │
│                                          │
│  📊 Репутация (на основе 45 оценок):    │
│  ┌────────────────────────────────────┐ │
│  │ Честность:    92/100 ✅            │ │
│  │ Поведение:    65/100 🟡            │ │
│  │ Командность:  81/100 ✅            │ │
│  └────────────────────────────────────┘ │
│                                          │
│  Жалобы на читинг: 1 из 45 матчей (2%) │
└──────────────────────────────────────────┘
```

**В турнирных матчах (для модераторов):**
```
Матч #15: Team Alpha vs Team Bravo

Team Alpha:
├─ Player1 (Trust: 90 | Rep: 85) ✅✅
├─ Player2 (Trust: 75 | Rep: 92) ✅✅
├─ Player3 (Trust: 45 | Rep: 67) ⚠️🟡
├─ Player4 (Trust: 88 | Rep: 78) ✅✅
└─ Player5 (Trust: 92 | Rep: 90) ✅✅

⚠️ Player3 на контроле (низкий Trust Score)
```

### 🗄️ Расширенная БД:

```sql
-- Таблица весов репортов (кеш)
CREATE TABLE report_weights (
  feedback_id INTEGER REFERENCES match_feedback(id),
  calculated_weight DECIMAL(3,2),
  weight_factors JSONB,
  calculated_at TIMESTAMP DEFAULT NOW()
);

-- Таблица флагов для проверки
CREATE TABLE moderation_flags (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  flag_type VARCHAR(50) CHECK (
    flag_type IN ('cheating_reports', 'toxic_behavior', 'poor_teamplay', 'manual')
  ),
  severity VARCHAR(20) CHECK (
    severity IN ('LOW', 'MEDIUM', 'HIGH', 'CRITICAL')
  ),
  weighted_score DECIMAL(5,2),
  evidence JSONB,
  status VARCHAR(20) DEFAULT 'PENDING' CHECK (
    status IN ('PENDING', 'REVIEWING', 'CONFIRMED', 'DISMISSED')
  ),
  assigned_to INTEGER REFERENCES users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  resolved_at TIMESTAMP
);

-- Индексы
CREATE INDEX idx_flags_status ON moderation_flags(status);
CREATE INDEX idx_flags_severity ON moderation_flags(severity);
CREATE INDEX idx_flags_user ON moderation_flags(user_id);
```

### 💰 Инвестиции:

**Разработка:**
- Backend (API, алгоритмы): $4,000-6,000
- Frontend (UI, формы): $2,000-3,000
- Testing & QA: $1,000-1,500
- **ИТОГО:** $7,000-10,500

**Операционные (monthly):**
- Модерация флагов: $500-1,000/мес
- Reward pool (coins): $300-500/мес
- **ИТОГО:** $800-1,500/мес

**Срок:** 2-3 недели

---

## 🎯 АРГУМЕНТЫ ЗА И ПРОТИВ

### ✅ ПЛЮСЫ:

1. **Защита от abuse:**
   - Взвешенное голосование (опытные игроки важнее)
   - Автоматическая детекция накруток
   - Фильтрация revenge reports

2. **Точность:**
   - Учитывает контекст (результат матча, репутация reviewer)
   - Требует пороговое количество репортов
   - Снижает false-positive на 60-70%

3. **Масштабируемость:**
   - Автоматизация большинства процессов
   - Модераторы проверяют только критические случаи
   - Самообучаемая система (ML готово)

4. **Геймификация:**
   - Reputation Index как престиж
   - Мотивация играть честно
   - Visible статус (badge в профиле)

5. **Дифференциация:**
   - FastCup/FACEIT НЕ имеют weighted voting
   - Уникальное конкурентное преимущество
   - Маркетинговая фишка

### ❌ МИНУСЫ:

1. **Сложность реализации:**
   - Требует продвинутые алгоритмы
   - Нужна тщательная балансировка весов
   - Больше времени на разработку (3 недели)

2. **Высокие затраты:**
   - $7k-10k на разработку
   - $800-1500/мес операционные
   - Требуется data scientist для ML

3. **Риск overengineering:**
   - Может быть слишком сложно для малой аудитории
   - Нужна критическая масса (1000+ активных игроков)
   - Первые месяцы недостаточно данных

4. **UX сложность:**
   - Детальные формы отпугивают
   - Многие будут пропускать
   - Нужны сильные стимулы

5. **Требует постоянную калибровку:**
   - Пороги нужно корректировать
   - Веса могут "уехать"
   - Нужна команда аналитиков

### 🎯 ОЦЕНКА:

**Сложность:** ⭐⭐⭐⭐ (4/5) - Сложно  
**Стоимость:** $7,000-10,500 (2-3 недели)  
**Эффективность:** ⭐⭐⭐⭐⭐ (5/5) - Отличная  
**ROI:** ⭐⭐⭐⭐ (4/5) - Хороший (при достаточной аудитории)  

**Рекомендация:** ⚠️ **УСЛОВНО** - отлично для будущего, но рано для MVP (нужна большая база игроков)

---

## 💡 ВАРИАНТ 3: TOURNAMENT-FOCUSED PEER REVIEW (Турнирный)

### 📋 Концепция:

**Система peer review оптимизированная под ТУРНИРЫ** (а не постоянный матчмейкинг). Фокус на качестве, а не количестве фидбека. Используется специфика турнирной структуры для создания надежных данных.

### 🎯 Ключевая идея:

Вместо оценки после КАЖДОГО матча, система запрашивает фидбек в **ключевые моменты турнира** с повышенной мотивацией и контекстом.

### 🎨 UI/UX:

**Момент 1: После выбывания из турнира**

```
┌──────────────────────────────────────────────────┐
│  💔 Вы выбыли из турнира "CS2 Cup #42"          │
│  Место: 5-8 (из 16)                             │
├──────────────────────────────────────────────────┤
│                                                   │
│  🎯 Помогите нам улучшить турниры!              │
│  Оцените игроков, с которыми играли (+50 🪙)    │
│                                                   │
│  Матч 1: vs Team Bravo (проигрыш 14:16)         │
│  Матч 2: vs Team Delta (победа 16:10)           │
│  Матч 3: vs Team Echo (проигрыш 8:16)           │
│                                                   │
│  Наиболее запомнившиеся игроки:                 │
│  ┌────────────────────────────────────────────┐  │
│  │ 🌟 EnemyPlayer1 (Team Echo)                │  │
│  │    Матч 3: разгромили нас 8:16             │  │
│  │                                            │  │
│  │    Ваша оценка его игры:                   │  │
│  │    [😊 Честная игра - просто сильнее]     │  │
│  │    [⚠️ Были подозрительные моменты]       │  │
│  │    [🚫 Явный чит - нужна проверка]        │  │
│  │                                            │  │
│  │    📊 Статистика матча:                    │  │
│  │    • K/D: 32/12 (2.67)                     │  │
│  │    • HS%: 68% (высокий, но не критичный)   │  │
│  │    • MVP: 8 раундов из 24                  │  │
│  └────────────────────────────────────────────┘  │
│                                                   │
│  [⏭️ Пропустить]              [✅ Отправить]     │
│                                                   │
│  💡 Ваша оценка поможет защитить турниры        │
│     от нечестных игроков!                       │
└──────────────────────────────────────────────────┘
```

**Момент 2: Финал турнира (для призеров)**

```
┌──────────────────────────────────────────────────┐
│  🏆 Поздравляем! Вы заняли 2 место!             │
│  Турнир: "CS2 Weekly Cup #42"                   │
│  Приз: 3000₽ + 500 🪙                           │
├──────────────────────────────────────────────────┤
│                                                   │
│  📋 Финальный опрос (БОНУС +100 🪙)             │
│                                                   │
│  Вопрос 1: Были ли подозрения на нечестную игру?│
│  ○ Нет, все играли честно                       │
│  ○ Да, у некоторых игроков были моменты         │
│  ○ Да, явные читеры (укажите кого)              │
│                                                   │
│  Если "Да" - укажите игроков:                   │
│  [Поиск по нику или выбор из списка...]         │
│                                                   │
│  Вопрос 2: Качество турнира (1-5):              │
│  ⭐⭐⭐⭐⭐                                         │
│                                                   │
│  Вопрос 3: Что можно улучшить? (опционально)   │
│  ┌────────────────────────────────────────────┐  │
│  │                                            │  │
│  └────────────────────────────────────────────┘  │
│                                                   │
│  [Отправить и получить бонус +100 🪙]           │
└──────────────────────────────────────────────────┘
```

**Момент 3: Топ-игроки турнира (Captain's Review)**

```
┌──────────────────────────────────────────────────┐
│  ⭐ Вы в топ-3 игроков турнира!                  │
│  MVP турнира: 8.5/10 rating                     │
│                                                   │
│  🎖️ СПЕЦИАЛЬНЫЙ ЗАПРОС                          │
│  Как опытный игрок, помогите выявить читеров    │
│  Ваша оценка имеет повышенный вес (3x)          │
│                                                   │
│  Просмотрите топ-моментов турнира:              │
│  [📹 Ace Round 23] [📹 Clutch 1v4] [📹 AWP 4K] │
│                                                   │
│  Были ли подозрительные игроки?                 │
│  [Список игроков с фильтром...]                 │
│                                                   │
│  Награда: +200 🪙 + Badge "Хранитель турниров"  │
│                                                   │
│  [Всё чисто]              [Отметить игроков]    │
└──────────────────────────────────────────────────┘
```

### 🎮 Специфика турнирной платформы:

#### 1. Контекстная оценка:

```javascript
const feedbackContext = {
  // Когда запрашиваем
  timing: [
    'after_elimination',     // После выбывания
    'after_tournament_end',  // После завершения турнира
    'for_top_players',       // Для призеров (больший вес)
    'suspicious_match'       // Если система детектировала аномалии
  ],
  
  // Что показываем
  context: {
    tournament_name: "CS2 Cup #42",
    your_place: "5-8",
    matches_played: 3,
    opponents_faced: [список игроков],
    stats_comparison: true, // Показываем статистику для контекста
    highlight_anomalies: true // Подсвечиваем подозрительные моменты
  },
  
  // Мотивация
  rewards: {
    base: 50,  // Базовая награда (выше чем Вариант 1)
    top_player_bonus: 150, // Бонус для призеров
    detailed_feedback_bonus: 100, // За детальный фидбек
    early_bird_bonus: 25 // За быстрый ответ (в течение часа)
  }
}
```

#### 2. Captain's Endorsement (Одобрение капитана):

```javascript
// Капитаны команд имеют особый статус
const captainEndorsement = {
  weight: 2.0, // Удвоенный вес голоса
  
  // Капитан может отметить игрока как "чистого"
  endorsement: {
    type: 'clean_player',
    reason: 'Играл против него 3 матча, всё честно',
    impact: 'Снижает вес негативных репортов на этого игрока'
  },
  
  // Или как подозрительного
  suspicion: {
    type: 'suspicious_player',
    rounds: [5, 12, 18], // Указать раунды
    description: 'Текстовое описание',
    impact: 'Флаг HIGH priority для модерации'
  }
}
```

#### 3. Tournament Integrity Score:

```javascript
// Оценка честности турнира в целом
const tournamentIntegrity = {
  // Собирается после завершения турнира
  metrics: {
    total_participants: 32,
    feedbacks_received: 24, // 75% completion rate
    
    // Репорты на читинг
    cheating_reports: 3,
    affected_players: 2,
    
    // Взвешенная оценка
    weighted_cheating_score: 4.5,
    
    // Общая оценка честности
    integrity_score: 92 // 0-100
  },
  
  // Визуализация
  badge: integrity_score > 90 ? '✅ Честный турнир' : 
         integrity_score > 70 ? '🟡 Требует внимания' :
         '🔴 Проблемы с читерами',
  
  // Влияние на организатора
  impact: {
    high_integrity: 'Бонус репутации организатору',
    low_integrity: 'Флаг для проверки следующих турниров'
  }
}
```

### 📊 Интеграция с существующими системами:

#### Mix-турниры (особенность вашей платформы):

```javascript
// После формирования mix-команд
async function collectTeammatePreferences() {
  // Игроки оценивают с кем НЕ хотят играть в следующий раунд
  
  const feedback = {
    question: "С кем бы НЕ хотели играть в следующем раунде?",
    options: [список тиммейтов из прошлого раунда],
    reasons: ['Токсичное поведение', 'Не коммуницирует', 'AFK/Тролль'],
    
    // Используется для балансировки команд
    impact: 'Система избегает повторного объединения конфликтующих игроков'
  };
  
  // Защита от abuse
  validation: {
    max_blacklist: 2, // Максимум 2 игрока из команды
    requires_reason: true,
    weight_by_consensus: 'Если 3+ игрока жалуются на одного - реальная проблема'
  };
}
```

#### Лобби системы (есть у вас):

```javascript
// В лобби перед матчем
const preLobbyCheck = {
  // Показать репутацию игроков
  display: {
    show_reputation: true,
    show_trust_score: true, // Для капитанов
    show_recent_reports: true // Если есть флаги
  },
  
  // Предупреждение
  warning: {
    if_low_reputation: 'У игрока PlayerX репутация 35/100 (токсичное поведение)',
    if_flagged: 'У игрока PlayerY есть непроверенные репорты на читинг',
    action: 'Капитан может запросить замену или продолжить'
  }
}
```

### 🗄️ Специализированная БД:

```sql
-- Фидбек привязан к турниру
CREATE TABLE tournament_feedback (
  id SERIAL PRIMARY KEY,
  tournament_id INTEGER REFERENCES tournaments(id),
  reviewer_id INTEGER REFERENCES users(id),
  reviewed_id INTEGER REFERENCES users(id),
  
  -- Контекст
  review_type VARCHAR(20) CHECK (
    review_type IN ('post_elimination', 'post_tournament', 'captain_review', 'top_player_review')
  ),
  
  -- Оценки
  fairness_rating VARCHAR(20),
  behavior_rating VARCHAR(20),
  teamplay_rating VARCHAR(20),
  
  -- Детали (если suspicious/cheating)
  suspected_cheat_types VARCHAR(50)[], -- ['aimbot', 'wallhack']
  suspicious_rounds INTEGER[],         -- [5, 12, 18]
  evidence_description TEXT,
  
  -- Вес
  calculated_weight DECIMAL(3,2),
  weight_factors JSONB,
  
  -- Награда
  coins_rewarded INTEGER DEFAULT 0,
  
  created_at TIMESTAMP DEFAULT NOW(),
  
  UNIQUE(tournament_id, reviewer_id, reviewed_id)
);

-- Агрегация по турниру
CREATE TABLE tournament_integrity_stats (
  tournament_id INTEGER PRIMARY KEY REFERENCES tournaments(id),
  
  -- Participation
  total_participants INTEGER,
  feedbacks_received INTEGER,
  completion_rate DECIMAL(5,2),
  
  -- Честность
  cheating_reports_count INTEGER DEFAULT 0,
  cheating_weighted_score DECIMAL(5,2) DEFAULT 0,
  flagged_players INTEGER DEFAULT 0,
  
  -- Поведение
  toxic_reports_count INTEGER DEFAULT 0,
  excellent_behavior_count INTEGER DEFAULT 0,
  
  -- Итоговая оценка
  integrity_score INTEGER CHECK (integrity_score BETWEEN 0 AND 100),
  integrity_badge VARCHAR(20),
  
  calculated_at TIMESTAMP DEFAULT NOW()
);
```

### 🎁 Reward система:

```javascript
const tournamentRewards = {
  // Базовые награды
  post_elimination_feedback: 50,  // coins
  post_tournament_feedback: 75,
  detailed_report: 100,
  
  // Бонусы
  early_response: 25,      // В течение 1 часа
  complete_all_opponents: 150, // Оценил всех
  captain_review: 200,     // Для капитанов
  top_player_review: 300,  // Для топ-3 игроков
  
  // Milestone rewards
  milestones: {
    feedbacks_10: { coins: 500, badge: 'Community Guardian' },
    feedbacks_50: { coins: 2500, badge: 'Tournament Protector' },
    accurate_reports_20: { coins: 5000, badge: 'Cheater Hunter' }
  },
  
  // Penalty за false reports
  false_report_penalty: -100, // Если репорт отклонен модератором
  abuse_detected: -500       // Если детектирована накрутка
}
```

### 📊 Специальные фичи:

#### 1. Highlight Reel Review:

```javascript
// Система автоматически выбирает топ-моменты турнира
const highlightReelReview = {
  // После турнира топ-игрокам показывают highlights
  clips: [
    {
      round: 23,
      player: 'SuspectPlayer',
      type: 'ace',
      stats: { hs_percentage: 100, time: '15 seconds' },
      question: 'Как вы оцениваете эту игру?',
      options: ['Скилл', 'Везение', 'Подозрительно', 'Читер']
    }
  ],
  
  // Только для опытных игроков
  eligibility: {
    min_tournament_rank: 'top_8',
    min_matches_played: 50,
    min_reputation: 70
  },
  
  // Высокая награда
  reward: 500 // coins за просмотр 10 клипов
}
```

#### 2. Captain's Council:

```javascript
// Капитаны имеют особый статус
const captainsCouncil = {
  // Приватный чат для капитанов
  private_chat: 'Обсуждение проблем турнира',
  
  // Коллективное решение
  voting: {
    question: 'Игрок PlayerX подозревается в читинге (3 репорта)',
    votes: [
      { captain: 'Captain1', vote: 'ban', weight: 2.0 },
      { captain: 'Captain2', vote: 'clean', weight: 2.0 },
      { captain: 'Captain3', vote: 'review', weight: 2.0 }
    ],
    
    // Требуется консенсус
    threshold: '60% капитанов за бан',
    
    // Действие
    action: 'Temporary ban + priority demo review'
  },
  
  // Reputation boost для капитанов
  captain_reputation_bonus: +10 // к Reputation Index
}
```

#### 3. Post-Tournament Report (для организаторов):

```javascript
// Отчет для создателя турнира
const tournamentReport = {
  tournament_id: 42,
  tournament_name: "CS2 Weekly Cup",
  
  // Статистика честности
  integrity: {
    overall_score: 88,
    cheating_incidents: 2,
    toxic_incidents: 5,
    flagged_players: ['Player1', 'Player2'],
    
    // Рекомендации
    recommendations: [
      'Проверить демо матчей с Player1 (4 репорта)',
      'Забанить Player2 (подтвержденный читер)',
      'Предупредить 3 игроков за токсичность'
    ]
  },
  
  // Feedback от участников
  participant_feedback: {
    total_responses: 24,
    avg_tournament_rating: 4.2,
    common_issues: ['Долгое ожидание между матчами', 'Проблемы с сервером'],
    positive_highlights: ['Честная игра', 'Хорошая организация']
  },
  
  // Экшны для организатора
  actions: {
    auto_ban: ['Player2'],
    need_review: ['Player1'],
    warnings: ['Player3', 'Player4', 'Player5']
  }
}
```

### 💰 Инвестиции:

**Разработка:**
- Backend (API, турнирный контекст): $5,000-7,000
- Frontend (UI для разных моментов): $3,000-4,500
- Highlight system (clip extraction): $2,000-3,000
- Captain's Council feature: $1,500-2,000
- Testing & QA: $1,500-2,000
- **ИТОГО:** $13,000-18,500

**Операционные (monthly):**
- Модерация (приоритетные флаги): $800-1,200/мес
- Reward pool (увеличен): $500-800/мес
- Video processing (highlights): $200-400/мес
- **ИТОГО:** $1,500-2,400/мес

**Срок:** 3-4 недели

---

## 🎯 АРГУМЕНТЫ ЗА И ПРОТИВ

### ✅ ПЛЮСЫ:

1. **Идеально под вашу специфику:**
   - Оптимизировано под турниры (не PUG)
   - Использует турнирный контекст
   - Работает с малым количеством матчей

2. **Высокое качество данных:**
   - Фидбек в ключевые моменты (лучше запоминается)
   - Контекст турнира повышает объективность
   - Топ-игроки дают более точные оценки

3. **Встроенная защита от abuse:**
   - Captain's Council (доверенные лица)
   - Weighted voting по статусу игрока
   - Tournament context предотвращает случайные репорты

4. **Уникальная фича:**
   - Ни у кого из конкурентов нет
   - Tournament Integrity Score = маркетинговая фишка
   - Captain's Council = престиж

5. **Масштабируемость:**
   - Работает с 10 участников
   - Не требует большой базы игроков
   - Растет с платформой

6. **Интеграция:**
   - Естественно встраивается в турнирный flow
   - Использует существующие роли (капитан)
   - Дополняет Trust Score

### ❌ МИНУСЫ:

1. **Высокая стоимость:**
   - $13k-18k на разработку
   - Дороже чем Варианты 1 и 2
   - Требует highlight processing

2. **Сложность реализации:**
   - Много условной логики (timing, context)
   - Captain's Council = дополнительная система
   - Highlight extraction = AI/ML нужен

3. **Зависимость от участия:**
   - Нужна высокая completion rate (>60%)
   - Без мотивации не будет работать
   - Требует постоянный reward pool

4. **Медленное накопление данных:**
   - Данные собираются только в турнирах
   - Не каждый день (в отличие от PUG)
   - Первые значимые данные через 2-3 месяца

5. **Требует обучение пользователей:**
   - Нужно объяснить систему
   - Captain's Council = новая роль
   - Highlight review = нужны инструкции

### 🎯 ОЦЕНКА:

**Сложность:** ⭐⭐⭐⭐⭐ (5/5) - Очень сложно  
**Стоимость:** $13,000-18,500 (3-4 недели)  
**Эффективность:** ⭐⭐⭐⭐⭐ (5/5) - Максимальная для турниров  
**ROI:** ⭐⭐⭐⭐ (4/5) - Хороший (долгосрочная инвестиция)  

**Рекомендация:** 🟡 **УСЛОВНО** - идеально подходит, но дорого и долго

---

## 📊 СРАВНИТЕЛЬНАЯ ТАБЛИЦА

| Параметр | Вариант 1<br>Basic | Вариант 2<br>Smart | Вариант 3<br>Tournament |
|----------|-------------------|-------------------|------------------------|
| **Сложность** | ⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **Стоимость** | $3k-5k | $7k-10.5k | $13k-18.5k |
| **Срок** | 1-2 недели | 2-3 недели | 3-4 недели |
| **Эффективность** | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **Защита от abuse** | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **Подходит для турниров** | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **Мотивация игроков** | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **Уникальность** | ⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **ROI** | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |

### Сравнение функционала:

| Функция | Вариант 1 | Вариант 2 | Вариант 3 |
|---------|-----------|-----------|-----------|
| **Post-match feedback** | ✅ | ✅ | ✅ |
| **Weighted voting** | ❌ | ✅ | ✅ |
| **Abuse detection** | ⚠️ Базовая | ✅ Продвинутая | ✅ Продвинутая |
| **Reputation Index** | ❌ | ✅ | ✅ |
| **Tournament context** | ❌ | ❌ | ✅ |
| **Captain's Council** | ❌ | ❌ | ✅ |
| **Highlight review** | ❌ | ❌ | ✅ |
| **Tournament Integrity Score** | ❌ | ❌ | ✅ |
| **Mix-team preferences** | ❌ | ❌ | ✅ |
| **Pre-lobby warnings** | ❌ | ⚠️ Частично | ✅ |

---

## 🎯 ФИНАЛЬНЫЕ РЕКОМЕНДАЦИИ

### Стратегия поэтапного внедрения:

#### PHASE 1 (Месяцы 1-2): Вариант 1 (Basic) - $3k-5k
```
✅ Быстрый старт (1-2 недели)
✅ Минимальные затраты
✅ Сбор первых данных
✅ Обучение пользователей системе
✅ Тестирование гипотез

Результат: 
- Feedback от 30-40% игроков
- Первые 100-200 оценок за месяц
- Понимание паттернов abuse
- Данные для улучшения
```

#### PHASE 2 (Месяцы 3-4): Добавить элементы Варианта 2 - +$4k-6k
```
✅ Weighted voting (на основе собранных данных)
✅ Reputation Index для игроков
✅ Автоматическая детекция abuse
✅ Флаги для модерации

Результат:
- Снижение false-positive на 60%
- Автоматизация 70% процессов
- Точность репортов 75%+
```

#### PHASE 3 (Месяцы 5-7): Добавить фичи Варианта 3 - +$6k-8k
```
✅ Tournament Integrity Score
✅ Captain's Council
✅ Highlight review (базовый)
✅ Pre-lobby warnings

Результат:
- Уникальная система для турниров
- Конкурентное преимущество
- Маркетинговая фишка
- Полная защита турниров
```

### 💰 Общий бюджет:

```
Phase 1: $3k-5k      (Quick Win)
Phase 2: $4k-6k      (Automation)
Phase 3: $6k-8k      (Unique Features)
────────────────────────────────────
ИТОГО:   $13k-19k    (6-7 месяцев)

vs сразу Вариант 3: $13k-18.5k (3-4 недели)
```

**Преимущества поэтапного подхода:**
- ✅ Раньше получаете результаты (Phase 1 через 2 недели)
- ✅ Меньше рисков (можно остановиться после Phase 1)
- ✅ Обучение на реальных данных
- ✅ Адаптация под feedback пользователей

---

## 🎯 МОЯ ФИНАЛЬНАЯ РЕКОМЕНДАЦИЯ

### 🥇 ОПТИМАЛЬНАЯ СТРАТЕГИЯ:

**СЕЙЧАС (первые 2 месяца):**
```
Вариант 1 (Basic Post-Match Feedback)
──────────────────────────────────────
✅ Быстро ($3-5k, 1-2 недели)
✅ Дешево
✅ Сразу приносит пользу
✅ Собирает данные для Phase 2
✅ Обучает пользователей

MVP функционал:
• Простая форма после матча
• 2 вопроса (честность + поведение)
• Базовая reward система (10-50 coins)
• Агрегация репортов
• Флаги для модерации при 3+ репортов
```

**ЧЕРЕЗ 2-3 МЕСЯЦА:**
```
Upgrade на Вариант 2 (Smart Reputation)
──────────────────────────────────────────
✅ Когда накопили 500+ feedbacks
✅ Понимаете паттерны abuse
✅ Есть база для weighted voting

Добавить:
• Weighted voting алгоритм
• Reputation Index
• Автоматическая детекция abuse
• Улучшенная модерация
```

**ЧЕРЕЗ 6 МЕСЯЦЕВ (при успехе):**
```
Добавить элементы Варианта 3 (Tournament-Focused)
────────────────────────────────────────────────────
✅ Когда аудитория 5000+ MAU
✅ Турниров 50+ в месяц
✅ Стабильная база капитанов

Добавить:
• Tournament Integrity Score
• Captain's Council
• Highlight review
• Pre-lobby warnings
```

---

## 📋 ДЕТАЛЬНЫЙ ПЛАН PHASE 1 (Quick Start)

### Что реализовать в первую очередь:

**Week 1: Backend**
```javascript
// 1. Создать таблицы БД
- match_feedback (основная)
- player_reputation (агрегация)

// 2. API Endpoints
POST /api/matches/:id/feedback
  - Принимает оценки
  - Валидация (один раз на пару reviewer-reviewed)
  - Начисление coins
  - Обновление reputation

GET /api/users/:id/reputation
  - Получить репутацию игрока
  - Историю feedbacks
  
GET /api/admin/suspicious-reports
  - Список игроков с 3+ cheating reports
  - Для модераторов

// 3. Автоматизация
- Trigger после завершения матча
- Уведомления игрокам
- Флаги при пороговых значениях
```

**Week 2: Frontend**
```javascript
// 1. Компонент PostMatchFeedback
- Модалка после завершения матча
- Список соперников + тиммейтов
- Простые кнопки-эмоджи
- Индикатор награды

// 2. Отображение репутации
- Badge в профиле
- Показ в лобби (для капитанов)
- Индикатор в сетке турнира

// 3. Админ-панель
- Вкладка "Suspicious Reports"
- Список флагов
- Действия (ban, dismiss)
```

### Минимальный MVP (5 дней):

```
ДЕНЬ 1-2: 
☐ Создать таблицы БД
☐ POST /api/matches/:id/feedback endpoint
☐ Базовая валидация

ДЕНЬ 3-4:
☐ Frontend модалка PostMatchFeedback
☐ Интеграция с завершением матча
☐ Rewards (coins)

ДЕНЬ 5:
☐ Админ-панель для репортов
☐ Тестирование
☐ Деплой
```

**Бюджет MVP:** $2,000-3,000  
**Срок MVP:** 5 дней

---

## 🚀 ИНТЕГРАЦИЯ С TRUST SCORE

### Синергия двух систем:

```javascript
// Комбинированная оценка риска
function calculateOverallRisk(userId) {
  const trustScore = await getTrustScore(userId);      // Steam данные
  const reputation = await getReputation(userId);      // Community feedback
  
  // Weighted combination
  const overallRisk = (
    (100 - trustScore) * 0.6 +     // Trust Score = 60% веса
    (100 - reputation) * 0.4       // Reputation = 40% веса
  );
  
  // Оба фактора критичны
  if (trustScore < 20 || reputation < 20) {
    return { risk: 'CRITICAL', action: 'BAN' };
  }
  
  if (trustScore < 40 && reputation < 40) {
    return { risk: 'HIGH', action: 'FLAG_FOR_REVIEW' };
  }
  
  return { risk: calculateRiskLevel(overallRisk), action: 'MONITOR' };
}
```

### Автоматические действия:

```javascript
const automatedActions = {
  // Критический: Trust Score низкий + много cheating reports
  critical: {
    condition: 'trustScore < 30 && cheatingReports >= 3',
    action: 'IMMEDIATE_BAN + priority_demo_review'
  },
  
  // Высокий: Один показатель проблемный
  high: {
    condition: 'trustScore < 40 || (reputation < 40 && cheatingReports >= 5)',
    action: 'TEMPORARY_BAN + manual_review'
  },
  
  // Средний: Предупреждающие сигналы
  medium: {
    condition: 'trustScore < 60 && reputation < 60',
    action: 'WATCH_LIST + restrict_premium_tournaments'
  },
  
  // Низкий: Токсичность без читерства
  low: {
    condition: 'reputation < 40 && toxicReports >= 10',
    action: 'WARNING + chat_restrictions'
  }
}
```

---

## 📖 ПРИМЕРЫ РЕАЛИЗАЦИИ

### Пример UI (Вариант 1 - рекомендуется для старта):

**Код компонента:**
```javascript
// frontend/src/components/PostMatchFeedback.js
import React, { useState } from 'react';
import './PostMatchFeedback.css';

function PostMatchFeedback({ match, onClose, onSubmit }) {
  const [feedbacks, setFeedbacks] = useState({});
  const [loading, setLoading] = useState(false);
  
  const opponents = match.opponents; // Игроки противоположной команды
  const teammates = match.teammates.filter(t => t.id !== currentUserId);
  
  const handleRating = (playerId, category, value) => {
    setFeedbacks(prev => ({
      ...prev,
      [playerId]: {
        ...prev[playerId],
        [category]: value
      }
    }));
  };
  
  const handleSubmit = async () => {
    setLoading(true);
    try {
      await api.post(`/api/matches/${match.id}/feedback`, {
        feedbacks: Object.entries(feedbacks).map(([userId, ratings]) => ({
          reviewed_id: parseInt(userId),
          ...ratings
        }))
      });
      
      alert('✅ Спасибо за feedback! Вам начислено 10 coins 🪙');
      onSubmit();
      onClose();
    } catch (error) {
      alert('❌ Ошибка отправки feedback');
    } finally {
      setLoading(false);
    }
  };
  
  return (
    <div className="feedback-modal">
      <div className="feedback-content">
        <h2>📊 Оцените игроков</h2>
        <p>Ваше мнение поможет сделать турниры честнее (+10 🪙)</p>
        
        <div className="feedback-section">
          <h3>Соперники:</h3>
          {opponents.map(player => (
            <div key={player.id} className="player-feedback-row">
              <span className="player-name">{player.username}</span>
              <div className="rating-buttons">
                <button 
                  className={feedbacks[player.id]?.fairness === 'clean' ? 'active' : ''}
                  onClick={() => handleRating(player.id, 'fairness', 'clean')}
                >
                  😊 Чисто
                </button>
                <button 
                  className={feedbacks[player.id]?.fairness === 'normal' ? 'active' : ''}
                  onClick={() => handleRating(player.id, 'fairness', 'normal')}
                >
                  😐 Норм
                </button>
                <button 
                  className={feedbacks[player.id]?.fairness === 'suspicious' ? 'active' : ''}
                  onClick={() => handleRating(player.id, 'fairness', 'suspicious')}
                >
                  ⚠️ Подозрительно
                </button>
                <button 
                  className={feedbacks[player.id]?.fairness === 'cheating' ? 'active danger' : ''}
                  onClick={() => handleRating(player.id, 'fairness', 'cheating')}
                >
                  ☠️ Чит
                </button>
              </div>
            </div>
          ))}
        </div>
        
        <div className="feedback-section">
          <h3>Тиммейты:</h3>
          {teammates.map(player => (
            <div key={player.id} className="player-feedback-row">
              <span className="player-name">{player.username}</span>
              <div className="rating-buttons">
                <button 
                  className={feedbacks[player.id]?.teamplay === 'excellent' ? 'active' : ''}
                  onClick={() => handleRating(player.id, 'teamplay', 'excellent')}
                >
                  👍 Отлично
                </button>
                <button 
                  className={feedbacks[player.id]?.teamplay === 'normal' ? 'active' : ''}
                  onClick={() => handleRating(player.id, 'teamplay', 'normal')}
                >
                  😐 Норм
                </button>
                <button 
                  className={feedbacks[player.id]?.teamplay === 'poor' ? 'active' : ''}
                  onClick={() => handleRating(player.id, 'teamplay', 'poor')}
                >
                  👎 Плохо
                </button>
              </div>
            </div>
          ))}
        </div>
        
        <div className="feedback-actions">
          <button onClick={onClose} className="btn-secondary">
            ⏭️ Пропустить
          </button>
          <button 
            onClick={handleSubmit} 
            disabled={Object.keys(feedbacks).length === 0 || loading}
            className="btn-primary"
          >
            {loading ? '⏳ Отправка...' : '✅ Отправить (+10 🪙)'}
          </button>
        </div>
        
        <p className="feedback-note">
          ⚠️ Ложные обвинения наказываются снижением вашей репутации
        </p>
      </div>
    </div>
  );
}

export default PostMatchFeedback;
```

### Backend endpoint (Вариант 1):

```javascript
// backend/routes/matches.js
router.post('/:matchId/feedback', authenticateToken, async (req, res) => {
  const { matchId } = req.params;
  const { feedbacks } = req.body; // Array of {reviewed_id, fairness, behavior, ...}
  const reviewerId = req.user.id;
  
  try {
    // Проверка что матч завершен
    const match = await pool.query(
      'SELECT * FROM matches WHERE id = $1 AND state = $2',
      [matchId, 'DONE']
    );
    
    if (match.rows.length === 0) {
      return res.status(400).json({ error: 'Match not completed' });
    }
    
    // Проверка что reviewer участвовал в матче
    const participation = await pool.query(`
      SELECT 1 FROM match_participants 
      WHERE match_id = $1 AND user_id = $2
    `, [matchId, reviewerId]);
    
    if (participation.rows.length === 0) {
      return res.status(403).json({ error: 'You did not participate in this match' });
    }
    
    // Сохранить feedbacks
    const client = await pool.connect();
    try {
      await client.query('BEGIN');
      
      let totalCoins = 0;
      
      for (const feedback of feedbacks) {
        // Проверка уникальности
        const existing = await client.query(
          'SELECT id FROM match_feedback WHERE match_id = $1 AND reviewer_id = $2 AND reviewed_id = $3',
          [matchId, reviewerId, feedback.reviewed_id]
        );
        
        if (existing.rows.length > 0) {
          continue; // Пропустить дубликат
        }
        
        // Определить тип (opponent или teammate)
        const feedbackType = await determineFeedbackType(matchId, reviewerId, feedback.reviewed_id);
        
        // Сохранить
        await client.query(`
          INSERT INTO match_feedback (
            match_id, reviewer_id, reviewed_id, feedback_type,
            fairness_rating, behavior_rating, teamplay_rating,
            communication_rating
          ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8)
        `, [
          matchId,
          reviewerId,
          feedback.reviewed_id,
          feedbackType,
          feedback.fairness || null,
          feedback.behavior || null,
          feedback.teamplay || null,
          feedback.communication || null
        ]);
        
        // Начислить coins
        totalCoins += 10;
      }
      
      // Начислить coins reviewer
      if (totalCoins > 0) {
        await client.query(
          'UPDATE user_coins SET balance = balance + $1 WHERE user_id = $2',
          [totalCoins, reviewerId]
        );
      }
      
      // Обновить агрегированную репутацию для reviewed игроков
      for (const feedback of feedbacks) {
        await updatePlayerReputation(feedback.reviewed_id);
      }
      
      await client.query('COMMIT');
      
      res.json({ 
        success: true, 
        coins_earned: totalCoins,
        feedbacks_saved: feedbacks.length
      });
      
    } catch (error) {
      await client.query('ROLLBACK');
      throw error;
    } finally {
      client.release();
    }
    
  } catch (error) {
    console.error('❌ Error saving feedback:', error);
    res.status(500).json({ error: 'Failed to save feedback' });
  }
});

// Вспомогательная функция
async function updatePlayerReputation(userId) {
  const stats = await pool.query(`
    SELECT 
      COUNT(*) as total,
      COUNT(CASE WHEN fairness_rating = 'clean' THEN 1 END) as clean,
      COUNT(CASE WHEN fairness_rating = 'normal' THEN 1 END) as normal,
      COUNT(CASE WHEN fairness_rating = 'suspicious' THEN 1 END) as suspicious,
      COUNT(CASE WHEN fairness_rating = 'cheating' THEN 1 END) as cheating,
      COUNT(CASE WHEN behavior_rating = 'good' THEN 1 END) as good_behavior,
      COUNT(CASE WHEN behavior_rating = 'toxic' THEN 1 END) as toxic
    FROM match_feedback
    WHERE reviewed_id = $1
  `, [userId]);
  
  const s = stats.rows[0];
  
  // Простой расчет репутации
  const fairnessScore = s.total > 0 
    ? ((s.clean * 100 + s.normal * 75 + s.suspicious * 25) / s.total)
    : 50;
  
  const behaviorScore = s.total > 0
    ? ((s.good_behavior * 100 + (s.total - s.good_behavior - s.toxic) * 60) / s.total)
    : 50;
  
  const reputationIndex = Math.round(fairnessScore * 0.7 + behaviorScore * 0.3);
  
  // Сохранить
  await pool.query(`
    INSERT INTO player_reputation (
      user_id, total_feedbacks, 
      clean_reports, normal_reports, suspicious_reports, cheating_reports,
      good_behavior, toxic_behavior,
      fairness_score, behavior_score, reputation_index
    ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)
    ON CONFLICT (user_id) DO UPDATE SET
      total_feedbacks = $2,
      clean_reports = $3,
      normal_reports = $4,
      suspicious_reports = $5,
      cheating_reports = $6,
      good_behavior = $7,
      toxic_behavior = $8,
      fairness_score = $9,
      behavior_score = $10,
      reputation_index = $11,
      updated_at = NOW()
  `, [
    userId, s.total, s.clean, s.normal, s.suspicious, s.cheating,
    s.good_behavior, s.toxic,
    fairnessScore, behaviorScore, reputationIndex
  ]);
  
  // Проверить пороги
  if (s.cheating >= 3) {
    await flagForModeration(userId, 'Multiple cheating reports');
  }
}
```

---

## ✅ ЗАКЛЮЧЕНИЕ

### Итоговая рекомендация:

**🥇 НАЧНИТЕ С ВАРИАНТА 1 (Basic)**

**Почему:**
1. ✅ Быстро (1-2 недели, можно MVP за 5 дней)
2. ✅ Дешево ($3-5k, MVP = $2-3k)
3. ✅ Сразу приносит пользу (фильтрация читеров)
4. ✅ Обучает пользователей системе
5. ✅ Собирает данные для улучшений
6. ✅ Можно upgrade на Вариант 2/3 позже

**Upgrade path:**
```
Месяц 1-2:  Вариант 1 ($3-5k)
            ↓
Месяц 3-4:  + Weighted voting ($4-6k)
            ↓
Месяц 6-7:  + Tournament features ($6-8k)
```

**Альтернативный вариант (если бюджет позволяет):**
- Сразу делать Вариант 2 (Smart Reputation) за $7-10k
- Получить все преимущества weighted voting
- Меньше переделок в будущем

**НЕ рекомендую:**
- Вариант 3 сразу (слишком дорого и долго для старта)
- Лучше как апгрейд через 6 месяцев

---

**Хотите, чтобы я реализовал Вариант 1 (MVP за 5 дней)?** 🚀

**Документ подготовлен:** 2 октября 2025  
**Статус:** ✅ ГОТОВО К ОБСУЖДЕНИЮ

